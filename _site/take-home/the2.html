<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Muhamad Ameer Noor">
<meta name="dcterms.date" content="2023-12-15">

<title>ISSS624 - Applied Geospatial Analytics - Take-home 2 - Applied Spatial Interaction Models: A case study of Singapore public bus commuter flows</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ISSS624 - Applied Geospatial Analytics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../hands-on/hoe1.html" rel="" target="">
 <span class="dropdown-text">1A - Geospatial Data Wrangling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../hands-on/hoe1-choropleth.html" rel="" target="">
 <span class="dropdown-text">1B - Choropleth Mapping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../hands-on/hoe2-spatialweight.html" rel="" target="">
 <span class="dropdown-text">2A - Spatial Weights and Application</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../hands-on/hoe2-globalautocor.html" rel="" target="">
 <span class="dropdown-text">2B - Global Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../hands-on/hoe2-localautocor.html" rel="" target="">
 <span class="dropdown-text">2C - Local Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../hands-on/hoe3.html" rel="" target="">
 <span class="dropdown-text">3 - Flow Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../hands-on/hoe4.html" rel="" target="">
 <span class="dropdown-text">4 - Geographically Weighted Regression (GWR)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../in-class/ice1.html" rel="" target="">
 <span class="dropdown-text">1 - Preparing The Data Flow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../in-class/ice2.html" rel="" target="">
 <span class="dropdown-text">2 - sfdep for Spatial Weights, GLSA &amp; EHSA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../in-class/ice3.html" rel="" target="">
 <span class="dropdown-text">3 - Calibrating Spatial Interaction Models with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../in-class/ice4.html" rel="" target="">
 <span class="dropdown-text">4 - GDS and SIM with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../in-class/ice5.html" rel="" target="">
 <span class="dropdown-text">5 - Spatial Econometric Interaction Models (SIEM)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Take-Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../take-home/the1.html" rel="" target="">
 <span class="dropdown-text">1 - Geospatial Analytics for Public Goods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../take-home/the2.html" rel="" target="">
 <span class="dropdown-text">2 - Applied Spatial Interaction Models (WIP)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/muhamad-ameer-noor/" rel="" target=""><i class="bi bi-linkedin" role="img" aria-label="Linkedin">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ameernoor" rel="" target=""><i class="bi bi-github" role="img" aria-label="Github">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=TS_ilSMAAAAJ&amp;hl=en&amp;oi=ao" rel="" target=""><i class="bi bi-book" role="img" aria-label="Google Scholar">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a></li>
  <li><a href="#preparation" id="toc-preparation" class="nav-link" data-scroll-target="#preparation"><span class="header-section-number">2</span> Preparation</a>
  <ul class="collapse">
  <li><a href="#import-library" id="toc-import-library" class="nav-link" data-scroll-target="#import-library"><span class="header-section-number">2.1</span> Import Library</a></li>
  <li><a href="#data-import-and-minor-wrangling" id="toc-data-import-and-minor-wrangling" class="nav-link" data-scroll-target="#data-import-and-minor-wrangling"><span class="header-section-number">2.2</span> Data Import and Minor Wrangling</a>
  <ul class="collapse">
  <li><a href="#geospatial-1" id="toc-geospatial-1" class="nav-link" data-scroll-target="#geospatial-1">Geospatial</a></li>
  <li><a href="#aspatial-1" id="toc-aspatial-1" class="nav-link" data-scroll-target="#aspatial-1">Aspatial</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling"><span class="header-section-number">3</span> Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#create-hexagon-layer" id="toc-create-hexagon-layer" class="nav-link" data-scroll-target="#create-hexagon-layer"><span class="header-section-number">3.1</span> Create Hexagon Layer</a></li>
  <li><a href="#combine-bus-stop-and-hexagon" id="toc-combine-bus-stop-and-hexagon" class="nav-link" data-scroll-target="#combine-bus-stop-and-hexagon"><span class="header-section-number">3.2</span> Combine Bus Stop and Hexagon</a></li>
  <li><a href="#combine-trips-and-hexagon" id="toc-combine-trips-and-hexagon" class="nav-link" data-scroll-target="#combine-trips-and-hexagon"><span class="header-section-number">3.3</span> Combine Trips and Hexagon</a></li>
  <li><a href="#final-duplicate-checking" id="toc-final-duplicate-checking" class="nav-link" data-scroll-target="#final-duplicate-checking"><span class="header-section-number">3.4</span> Final Duplicate Checking</a></li>
  <li><a href="#construct-o-d-matrix" id="toc-construct-o-d-matrix" class="nav-link" data-scroll-target="#construct-o-d-matrix"><span class="header-section-number">3.5</span> Construct O-D Matrix</a></li>
  <li><a href="#create-distance-variable" id="toc-create-distance-variable" class="nav-link" data-scroll-target="#create-distance-variable"><span class="header-section-number">3.6</span> Create Distance Variable</a></li>
  <li><a href="#remove-intra-zonal-flows" id="toc-remove-intra-zonal-flows" class="nav-link" data-scroll-target="#remove-intra-zonal-flows"><span class="header-section-number">3.7</span> Remove Intra-Zonal Flows</a></li>
  </ul></li>
  <li><a href="#visualize-the-desire-lines" id="toc-visualize-the-desire-lines" class="nav-link" data-scroll-target="#visualize-the-desire-lines"><span class="header-section-number">4</span> Visualize the Desire Lines</a>
  <ul class="collapse">
  <li><a href="#rd-quantile-trips-175" id="toc-rd-quantile-trips-175" class="nav-link" data-scroll-target="#rd-quantile-trips-175"><span class="header-section-number">4.1</span> 3rd Quantile Trips (175)</a></li>
  <li><a href="#th-quantile-trips-6082" id="toc-th-quantile-trips-6082" class="nav-link" data-scroll-target="#th-quantile-trips-6082"><span class="header-section-number">4.2</span> 99th Quantile Trips (6082)</a></li>
  <li><a href="#rd-quantile-distance-8923" id="toc-rd-quantile-distance-8923" class="nav-link" data-scroll-target="#rd-quantile-distance-8923"><span class="header-section-number">4.3</span> 3rd Quantile Distance (8923)</a></li>
  <li><a href="#th-quantile-distance-18587" id="toc-th-quantile-distance-18587" class="nav-link" data-scroll-target="#th-quantile-distance-18587"><span class="header-section-number">4.4</span> 99th Quantile Distance (18587)</a></li>
  <li><a href="#use-gif" id="toc-use-gif" class="nav-link" data-scroll-target="#use-gif"><span class="header-section-number">4.5</span> Use GIF</a></li>
  </ul></li>
  <li><a href="#assembling-push-pull-factor" id="toc-assembling-push-pull-factor" class="nav-link" data-scroll-target="#assembling-push-pull-factor"><span class="header-section-number">5</span> Assembling Push &amp; Pull Factor</a>
  <ul class="collapse">
  <li><a href="#push" id="toc-push" class="nav-link" data-scroll-target="#push"><span class="header-section-number">5.1</span> Push</a></li>
  </ul></li>
  <li><a href="#spatial-interaction-model" id="toc-spatial-interaction-model" class="nav-link" data-scroll-target="#spatial-interaction-model"><span class="header-section-number">6</span> Spatial Interaction Model</a>
  <ul class="collapse">
  <li><a href="#correlation-analysis" id="toc-correlation-analysis" class="nav-link" data-scroll-target="#correlation-analysis"><span class="header-section-number">6.1</span> Correlation Analysis</a></li>
  <li><a href="#run-the-model" id="toc-run-the-model" class="nav-link" data-scroll-target="#run-the-model"><span class="header-section-number">6.2</span> Run the Model</a></li>
  <li><a href="#compare-the-result" id="toc-compare-the-result" class="nav-link" data-scroll-target="#compare-the-result"><span class="header-section-number">6.3</span> Compare The Result</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6.4</span> Conclusion</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">7</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home 2 - Applied Spatial Interaction Models: A case study of Singapore public bus commuter flows</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Muhamad Ameer Noor </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 15, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">December 17, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/the2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Illustration</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tmap, sf, tidyverse, sfdep, knitr, Hmisc, mapview, DT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Overview</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">The Scene</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">The Objective</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">The Method</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false">The Data</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>Understanding why city residents wake up early to travel from home to work and assessing the consequences of discontinuing a public bus service along a specific route are key challenges faced by transport operators and urban managers in the realm of urban mobility. Traditionally, answering such questions relied on expensive, time-consuming commuter surveys. However, these surveys not only demanded considerable resources but also yielded data that took a substantial amount of time to clean and analyze, often rendering it outdated by the time reports were ready.</p>
<p>In today’s digital era, urban infrastructures, including public buses and mass rapid transits, are becoming increasingly digital. The proliferation of technologies like GPS on vehicles and SMART cards for public transport users generates vast geospatial data sets, offering insights into movement patterns over time and space. Despite this wealth of data, planners struggle to effectively leverage and transform it into valuable information, impacting the return on investment in data collection and management.</p>
<p>To address this gap, this exercise conducts a case study showcasing the potential of Geographic Information System and Spatial Data Analysis (GDSA). By integrating data from various sources, this approach aims to build spatial interaction models that unveil the factors influencing urban mobility patterns in the context of public bus transit.</p>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>This task aims to achieve specific goals, focusing on General Geospatial Data Science and Spatial Interaction Modeling.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">General Geospatial Data Science</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Spatial Interaction Modeling</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>For the General Geospatial Data Science, the aim is to do the following: - Create a detailed hexagon map (375m distance from center to edges) representing Traffic Analysis Zones (TAZ). - Various time will have different pattern of traffic flow. For this study, the focus is on the period of <strong><em>weekday morning peak from 6am to 9am</em></strong>. - Develop an Origin-Destination (O-D) matrix illustrating commuter flows during the chosen time interval. - Visualize passenger trip flows using geospatial methods, analyzing the observed spatial patterns. - Gather relevant data, both spatial and aspatial, from publicly available sources. - Generate a distance matrix based on the earlier derived hexagon data.</p>
<div class="callout callout-style-default callout-note callout-titled" title="is 375m a magical number?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
is 375m a magical number?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Studies have found that people are usually willing to walk approximately 750 meters to get to public transportation. A more specific comfortable walking distance that takes into account the local weather and how cities are laid out.</p>
<p>When planning city maps and deciding where to place public transport stops, we use hexagons to represent areas on the map. Why hexagons? They fit together perfectly without wasting any space, which makes them great for dividing the map into zones. To match the 750-meter walking distance, each hexagon is sized so that the distance from the center to any edge is half that distance, which is 375 meters. This ensures that anyone within the hexagon is no more than a 750-meter walk away from the center, where a public transport stop would be ideally located. This method is a smart way to make sure that everyone has easy access to transport within a reasonable walking distance.</p>
<p><em>summarized from: <a href="https://www.jstor.org/stable/26202654">Daniels &amp; Mulley</a>, <a href="https://medium.com/swlh/spatial-data-analysis-with-hexagonal-grids-961de90a220e">Dhuri</a>, <a href="https://www.kontur.io/blog/h3-hexagonal-grid/">Sekste &amp; Kazakov</a>, and in-class explanation from <a href="https://faculty.smu.edu.sg/profile/kam-tin-seong-486">Prof Kam Tin Seong</a></em></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="what is Traffic Analysis Zones (TAZ)?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
what is Traffic Analysis Zones (TAZ)?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A Traffic Analysis Zone (TAZ) is a way of dividing a city into smaller areas for transportation planning. Each TAZ has some information about the people and places in it, such as how many people live there, how many cars they have, and where they work or go to school. These information help planners understand how people travel and what kind of transportation they need.</p>
<p>Some key points about TAZs are:</p>
<ul>
<li><p>The size and shape of a TAZ can vary depending on the location and the purpose of the study. For example, a TAZ in a downtown area might be smaller and more regular than a TAZ in a rural area.</p></li>
<li><p>The choice of a TAZ system is very important because it affects the accuracy and usefulness of the transportation models. A good TAZ system should reflect the reality of the travel patterns and demands in the city.</p></li>
<li><p>AZs are not fixed and can be changed or updated over time to reflect new data or changes in the city. However, changing TAZs can also cause some problems, such as losing historical data or making comparisons difficult.</p></li>
</ul>
<p><em>Summarized from: <a href="https://tmg.utoronto.ca/files/Reports/Traffic-Zone-Guidance_March-2021_Final.pdf">Miller, 2021</a></em></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="what is Origin-Destination (O-D) matrix?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
what is Origin-Destination (O-D) matrix?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>An Origin-Destination (O-D) matrix is a way of showing how many trips are made from one place to another in a given area. For example, an O-D matrix can tell us how many people travel from their home to their work, or from their hotel to a tourist attraction, or from one city to another. An O-D matrix can help us understand the travel patterns and demands of people, and plan for better transportation systems.</p>
<p>An O-D matrix usually looks like a table, where the rows represent the origins (where the trips start) and the columns represent the destinations (where the trips end). Each cell in the table shows the number of trips between a specific origin and destination. Sometimes, the table can also include other information, such as the mode of transportation (car, bus, bike, etc.), the time of the day, or the purpose of the trip.</p>
<p>Here is an example of a simple O-D matrix for a city with four zones (A, B, C, and D):</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>0</td>
<td>10</td>
<td>5</td>
<td>15</td>
<td>30</td>
</tr>
<tr class="even">
<td>B</td>
<td>20</td>
<td>0</td>
<td>10</td>
<td>10</td>
<td>40</td>
</tr>
<tr class="odd">
<td>C</td>
<td>10</td>
<td>15</td>
<td>0</td>
<td>5</td>
<td>30</td>
</tr>
<tr class="even">
<td>D</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>0</td>
<td>15</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>35</td>
<td>30</td>
<td>20</td>
<td>30</td>
<td>115</td>
</tr>
</tbody>
</table>
<p>This table tells us that there are 115 trips in total in the city, and that the most common origin-destination pair is A-D, with 15 trips. It also tells us that no one travels within the same zone (the diagonal cells are zero).</p>
<p>An O-D matrix can be created from different sources of data, such as surveys, GPS, mobile phones, or social media. Depending on the data source, the level of detail and accuracy of the O-D matrix can vary. For example, a survey might ask people to report their exact home and work locations, while a GPS device might only record the coordinates of the start and end points of a trip. Therefore, different methods and techniques are needed to process and analyze the data, and to convert them into a meaningful O-D matrix.</p>
<p><em>Summarized From: <a href="https://isprs-archives.copernicus.org/articles/XLIII-B4-2020/449/2020/isprs-archives-XLIII-B4-2020-449-2020.pdf">Coşkun, et al., 2020</a></em></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="what is trip flows?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
what is trip flows?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Trip flows are the movements of people or things from one place to another in a given area. For example, trip flows can show how many people travel from their home to their work, or from one city to another, or from one country to another. Trip flows can help us understand the patterns and reasons of these movements, and how they affect the environment, the economy, and the society.</p>
<p><em>Summarized from: <a href="https://doi.org/10.1007/978-3-030-55462-0_7">Tao Ran, 2021</a></em></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="spatial vs aspatial data">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
spatial vs aspatial data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Spatial data is data that has a geographic or spatial component, meaning that it is related to a specific location on the Earth’s surface. For example, the coordinates of a city, the shape of a lake, or the population density of a region are all spatial data. Spatial data can be represented using maps, graphs, or statistics, and can be analyzed using Geographic Information Systems (GIS).</p>
<p>Aspatial data is data that does not have a direct connection to a specific location. For example, the name of a person, the color of a car, or the price of a product are all aspatial data. Aspatial data can be represented using tables, charts, or text, and can be analyzed using various methods such as arithmetic, logic, or statistics.</p>
<p>The main difference between spatial and aspatial data is that spatial data can show the spatial relationships and patterns of the data, such as distance, direction, or proximity, while aspatial data cannot. Spatial data can also be combined with aspatial data to provide more information and insights. For example, a map of a city can show both the spatial data (the location and shape of the buildings) and the aspatial data (the name and use of the buildings).</p>
<p><em>Summarized from: <a href="https://cengel.github.io/R-spatial/intro.html">Cengel</a></em></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="what is distance matrix?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
what is distance matrix?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A distance matrix is a way of showing how far away different places are from each other in a given area. For example, a distance matrix can tell us how many kilometers or minutes it takes to travel from one city to another by car, bus, or bike. Applying geospatial analytics on distance matrix can help us understand the patterns and reasons of these movements, and how they affect the environment, the economy, and the society. <em>dive deeper at (ArcGIS)[https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/distance-analysis.htm]</em></p>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>For the General Spatial Interaction Model, the aim is to do the following:</p>
<ul>
<li><p>Adjust spatial interaction models to identify factors influencing urban commuting during the specified time.</p></li>
<li><p>Present modeling results using suitable geovisualization and graphical methods.</p></li>
<li><p>Interpret the outcomes to gain insights into the factors impacting commuting flows in the urban landscape during the selected time frame.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="what is spatial interaction model?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
what is spatial interaction model?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A spatial interaction model is a way of describing how people or things move from one place to another in a given area. For example, a spatial interaction model can show how many people commute from their home to their work, or how many goods are traded between different cities or countries. A spatial interaction model can help us understand the patterns and reasons of these movements, and how they affect the environment, the economy, and the society.</p>
<p>One of the most common spatial interaction models is the gravity model, which is based on an analogy to the physical law of gravity. The gravity model assumes that the movement between two places is proportional to their size (such as population or income) and inversely proportional to their distance. The gravity model can be written as:</p>
<p><span class="math display">\[T_{ij} = k \frac{v_i^{\lambda} w_j^{\alpha}}{d_{ij}^{\beta}}\]</span></p>
<p>where <span class="math inline">\(T_{ij}\)</span> is the movement from place <span class="math inline">\(i\)</span> to place <span class="math inline">\(j\)</span>, <span class="math inline">\(v_i\)</span> is the propulsiveness factor from the origin(<span class="math inline">\(i\)</span>) place,<span class="math inline">\(w_j\)</span> is the attractiveness factor from the destination (<span class="math inline">\(j\)</span>), and <span class="math inline">\(d_{ij}\)</span> is the distance between the two places. <span class="math inline">\(k\)</span> is a constant model parameter, while <span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\alpha\)</span>, and <span class="math inline">\(\beta\)</span> are parameters that measures the effect of their respective variables.</p>
<p>There are other types of spatial interaction models, such as the potential model and retail model, which have different assumptions and formulations. These models can be used to explain different kinds of movements, such as migration, tourism, or disease spread.</p>
<p>References: <a href="https://isss624-ay2023-24nov.netlify.app/lesson/lesson03/lesson03-sim#/title-slide">Kam Tin Seong</a> and <a href="https://cran.r-project.org/web/packages/simodels/vignettes/simodels.html.">Spatial interaction models with R</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<p>The spatial interaction models being used in this task are the variants of <strong>Gravity Model</strong> including <strong>Unconstrained</strong>, <strong>Origin Constrained</strong>, <strong>Destination Constrained</strong>, and <strong>Doubly Constraint</strong>. The models’ performance will be compared to see which one is more appropriate to use in the modelling.</p>
<div class="callout callout-style-default callout-note callout-titled" title="What is Unconstrained Gravity Model?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What is Unconstrained Gravity Model?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The Unconstrained Gravity Model is a simple form of the gravity model where the principle of conservation is ignored. This means that the interaction between two locations is not limited by the total number of interactions at the origin or destination. In this model, the interaction between two locations is a constant scaling factor, independent of all origins and destinations.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="What is Origin Constrained Gravity Model?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What is Origin Constrained Gravity Model?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The Origin/Production Constrained Gravity Model, also known as the production constrained model, includes origin-specific balancing factors that act as constraints. These constraints ensure that the estimated rows of the flow data matrix sum to the observed row totals. In other words, the total number of interactions originating from a location is fixed, and the model distributes these interactions across various destinations.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="What is Destination Constrained Gravity Model?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What is Destination Constrained Gravity Model?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The Destination/Attraction Constrained Gravity Model, also known as the attraction constrained model, includes destination-specific balancing factors that act as constraints. These constraints ensure that the estimated columns of the flow data matrix sum to the observed column totals. This means that the total number of interactions attracted to a location is fixed, and the model distributes these interactions across various origins.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="What is Doubly Constrained Gravity Model?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What is Doubly Constrained Gravity Model?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The Doubly Constrained Gravity Model includes both origin and destination-specific balancing factors that act as constraints. These constraints ensure that the estimated rows and columns of the flow data matrix sum to the observed row and column totals. In other words, both the total number of interactions originating from a location and attracted to a location are fixed.</p>
</div>
</div>
</div>
<p>To dive deeper on these models, explanation can be found on research by <a href="https://researchrepository.wvu.edu/rri-web-book/16/">Haynes &amp; Fotheringham, 1985</a> and class materials by <a href="https://r4gdsa.netlify.app/chap16">Prof Kam Tin Seong</a></p>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<p>the content of the following panel explained what aspatial and geospatial data are used in this project.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Aspatial</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Geospatial</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Passenger Volume by Origin Destination Bus Stops</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">HDB</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">School</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<ul>
<li><p>October 2023 Period</p></li>
<li><p>downloaded from <a href="https://datamall.lta.gov.sg/content/datamall/en/dynamic-data.html">LTA DataMall - Dynamic Dataset</a> via <a href="https://datamall.lta.gov.sg/content/dam/datamall/datasets/LTA_DataMall_API_User_Guide.pdf">API</a></p></li>
<li><p><code>csv</code> format.</p></li>
<li><p>Columns/Fields in the dataset includes YEAR_MONTH, DAY_TYPE, TIME_PER_HOUR, PT_TYPE, ORIGIN_PT_CODE, DESTINATION_PT_CODE, and TOTAL_TRIPS.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="metadata">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
metadata
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p>YEAR_MONTH: Represent year and Month in which the data is collected. Since it is a monthly data frame, only one unique value exist in each data frame.</p></li>
<li><p>DAY_TYPE: Represent type of the day which classified as <em>weekdays</em> or <em>weekends/holidays</em>.</p></li>
<li><p>TIME_PER_HOUR: Hour which the passenger trip is based on, in intervals from 0 to 23 hours.</p></li>
<li><p>PT_TYPE: Type of public transport, Since it is bus data sets, only one unique value exist in each data frame (i.e.&nbsp;<em>bus</em>)</p></li>
<li><p>ORIGIN_PT_CODE: ID of origin bus stop</p></li>
<li><p>DESTINATION_PT_CODE: ID of destination bus stop</p></li>
<li><p>TOTAL_TRIPS: Number of trips which represent passenger volumes</p></li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Tutorial on Fetching the Data">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tutorial on Fetching the Data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Click this <a href="https://datamall.lta.gov.sg/content/datamall/en/dynamic-data.html">link</a>, and click the <code>Request for API Access</code> <img src="../images/tutorial1.jpg" class="img-fluid"></p></li>
<li><p>Fill in the required form <img src="../images/tutorial2.jpg" class="img-fluid"></p></li>
<li><p>Check email for confirmation. The <code>API Account Key</code> will be required for later step. <img src="../images/tutorial3.jpg" class="img-fluid"></p></li>
<li><p>The user guide from LTA <a href="https://datamall.lta.gov.sg/content/dam/datamall/datasets/LTA_DataMall_API_User_Guide.pdf">here</a> will explains how to make API calls. The user guide also provide the link required for various kind of dataset, keep the link for future use. <img src="../images/tutorial4.jpg" class="img-fluid"></p></li>
<li><p><em>The following step assume usage of desktop apps version of <code>Postman</code> to make the API call</em>. Firstly, go to <a href="https://www.postman.com/">Postman</a> and click on the logo of the OS system that you are using. <img src="../images/tutorial5.jpg" class="img-fluid"></p></li>
<li><p><em>The following step is for Windows User, adjust accordingly if you use other OS</em>. Click on the dowload button, install the apps, and launch it. <img src="../images/tutorial6.png" class="img-fluid"></p></li>
<li><p>In the apps, copy-paste the url from step 4, and make sure that the option is set to <code>GET</code>. In this case where the data is monthly, you need to add a parameter of the month data that you want to download in the format of YYYYMM (202308 shown in the example). The parameter is under <code>Params</code> section. <img src="../images/tutorial7.png" class="img-fluid"></p></li>
<li><p>Next, go to <code>Headers</code> section and add AccountKey which value can be obtained from step 3. Click the blue <code>Send</code> button. <img src="../images/tutorial8.png" class="img-fluid"></p></li>
<li><p>Click the link that will come out on the bottom of the apps, it will be opened in a new tab. <img src="../images/tutorial9.png" class="img-fluid"></p></li>
<li><p>In this last step, click <code>Send and Download</code> in the new tab. You can choose where to put the data and the download will start. <img src="../images/tutorial10.jpg" class="img-fluid"></p></li>
</ol>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>The dataset contains comprehensive information about various Housing and Development Board (HDB) blocks situated in Singapore. The dataset not only includes details on the number and types of dwelling units but also crucially provides the geographic coordinates, specifically the longitudes and latitudes, corresponding to each HDB block. This geographical information opens the door to transforming the dataset into a spatial data frame, enabling us to treat the HDB block details as a spatial object. By leveraging these coordinates, we can engage in spatial analysis and visualization, gaining valuable insights into the spatial distribution and relationships among different HDB blocks across Singapore. This spatial perspective enhances the depth of understanding and opens avenues for exploring the geographical patterns inherent in the HDB block dataset. The original dataset can be downloaded from <a href="https://beta.data.gov.sg/collections/150/view">Singapore’s National Open Data Collection</a>. However, the original dataset does not contain geoidentifier. The geoidentifier in the HDB dataset that is used here was provided by <a href="https://faculty.smu.edu.sg/profile/kam-tin-seong-486">Prof Kam Tin Seong</a>.</p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>The School Directory and Information dataset, sourced from <a href="https://beta.data.gov.sg/collections/457/datasets/d_688b934f82c1059ed0a6993d2a829089/view">Singapore’s National Open Data Collection</a>, provides valuable information pertinent to the morning period, notably involving students commuting to school. The dataset encompasses details about the locations, implicitly indicated by the ‘POSTAL_CODE’ field, of MOE kindergartens, primary schools, secondary schools, and junior colleges. Notably, it excludes information on the locations of ITEs, polytechnics, and universities. With a total of 346 records, this dataset serves as a comprehensive resource for understanding the geographical distribution of various educational institutions.</p>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Geospatial data in <code>shp</code> format are used in this project, as shown in the following panel:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Bus Stop Location</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">URA Master Plan 2019 (MPSZ)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Hexagon</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">Other Supporting Data</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<ul>
<li><p>provides information about all the bus stops currently being serviced by buses, including the bus stop code (identifier) and location coordinates.</p></li>
<li><p>downloaded from <a href="https://datamall.lta.gov.sg/content/datamall/en/static-data.html">LTA DataMall - Static Dataset</a></p></li>
<li><p>Columns/Fields in the dataset includes BUS_STOP_N, BUS_ROOF_N, LOC_DESC, and geometry.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="metadata">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
metadata
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>BUS_STOP_N: The unique identifier for each bus stop.</li>
<li>BUS_ROOF_N: The identifier for the bus route or roof associated with the bus stop.</li>
<li>LOC_DESC: Location description providing additional information about the bus stop’s surroundings.</li>
<li>geometry: The spatial information representing the location of each bus stop as a point in the SVY21 projected coordinate reference system.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<ul>
<li><p>Provides information about the sub-zone boundary of Urban Redevelopment Authority (URA) Master Plan 2019 (MPSZ-2019).</p></li>
<li><p>The original dataset can be downloaded from <a href="https://beta.data.gov.sg/">Singapore’s National Open Data Collection</a>. However, the original dataset have a different file type from the one that is used in this project. The changed file type of the data was provided by <a href="https://faculty.smu.edu.sg/profile/kam-tin-seong-486">Prof Kam Tin Seong</a>.</p></li>
<li><p>Columns/Fields in the dataset includes SUBZONE_N, SUBZONE_C, PLN_AREA_N, PLN_AREA_C, REGION_N, REGION_C, and geometry</p></li>
<li><p>While the analysis primarily focuses on hexagon cells, incorporating the Master Planning Sub-Zone 2019 file enables the integration of additional point layers like Retail and Leisure onto the Singapore map. This integration facilitates the visualization of their respective locations within various planning sub-zones across Singapore.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="metadata">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
metadata
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>SUBZONE_N: The unique name for each subzone boundary.</li>
<li>SUBZONE_C: The unique identifier for each subzone boundary.</li>
<li>PLN_AREA_N: The unique name for each planning area.</li>
<li>PLN_AREA_C: The unique identifier for each planning area</li>
<li>REGION_N: The unique name for each region.</li>
<li>REGION_C: The unique identifier for each region.</li>
<li>geometry: The spatial information representing the location of each subzone boundary in Coordinate Reference System (CRS) from World Geodetic Systems (WGS) 84.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>A <a href="https://desktop.arcgis.com/en/arcmap/latest/tools/spatial-statistics-toolbox/h-whyhexagons.htm">hexagon</a> layer of 375m (perpendicular distance between the centre of the hexagon and its edges.) Each spatial unit is regular in shape and finer than the Master Plan 2019 Planning Sub-zone GIS data set of URA.</p>
<div class="callout callout-style-default callout-note callout-titled" title="why hexagon?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
why hexagon?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p><strong><em>Uniform Distances Everywhere</em></strong>: Think of hexagons as honeycomb cells. Each cell (hexagon) touches its neighbors at the same distance from its center. It’s like standing in the middle of a room and being the same distance from every wall, making it easier to measure and compare things.</p></li>
<li><p><strong><em>Outlier-Free Shape</em></strong>: Hexagons are like well-rounded polygons without any pointy tips. Sharp corners can create odd spots in data, but hexagons smoothly cover space without sticking out anywhere. This helps prevent weird data spikes that don’t fit the pattern.</p></li>
<li><p><strong><em>Consistent Spatial Relationships</em></strong>: Imagine a beehive where every hexagon is surrounded by others in the same pattern. This regular pattern is great for analyzing data because you can expect the same relationships everywhere, making the data predictable and easier to work with.</p></li>
<li><p><strong><em>Ideal for Non-Perpendicular Features</em></strong>: Real-world features like rivers and roads twist and turn. Squares can be awkward for mapping these, but hexagons, which are more circular, can follow their flow better. This way, a hexagon-based map can mimic the real world more closely than a checkerboard of squares.</p></li>
</ul>
<p>Summarized from: <a href="https://medium.com/swlh/spatial-data-analysis-with-hexagonal-grids-961de90a220e">Dhuri</a>, and <a href="https://www.kontur.io/blog/h3-hexagonal-grid/">Sekste &amp; Kazakov</a>.</p>
</div>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<p>The following dataset will support as propulsive/attractive factors for the modelling. The data was provided by <a href="https://faculty.smu.edu.sg/profile/kam-tin-seong-486">Prof Kam Tin Seong</a>. The data includes:</p>
<ul>
<li><p>Business: provide information about business locations across Singapore</p></li>
<li><p>Rapid Transit System Station: encompasses the geographical positions of Mass Rapid Transit (MRT) and Light Rail Transit (LRT) stations in Singapore, represented as polygon shapes.</p></li>
<li><p>Train Station Exit Layer: includes exit points for all MRT and LRT stations in Singapore, stored as individual points.</p></li>
<li><p>Entertainment: highlights the locations of entertainment venues in Singapore, such as cinemas and theaters, presented as points.</p></li>
<li><p>Food &amp; Beverage: captures the locations of Food &amp; Beverage venues in Singapore, such as restaurants and cafes, organized as points.</p></li>
<li><p>Financial Services: showcases the locations of Financial Services in Singapore, encompassing ATMs, money changers, and banks, stored as individual points.</p></li>
<li><p>Leisure &amp; Recreation: denotes the locations of Leisure and Recreation venues in Singapore, spanning sports venues, museums, and galleries, organized as points.</p></li>
<li><p>Retails: documents the locations of Retail venues in Singapore, encompassing all shops that may not fit into other categories, presented as points.</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="preparation" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Preparation</h1>
<p>Before starting with the analysis, we have to load the library and import the data. This section also contains minor checking and setup of the data.</p>
<section id="import-library" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="import-library"><span class="header-section-number">2.1</span> Import Library</h2>
<p>The following code chunk utilizing <a href="https://www.rdocumentation.org/packages/pacman/versions/0.5.1">pacman</a> will import the required library (and install it if it does not exist in the environment yet).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tmap, sf, tidyverse, sfdep, knitr, Hmisc, mapview, DT, sp, stplanr, reshape2, skimr, performance, plotly, h3jsr, units, httr, corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Packages Explanations">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Packages Explanations
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/tmap/">tmap</a>: Used for creating thematic maps in R, both static and interactive, with extensive mapping capabilities.</p></li>
<li><p><a href="https://r-spatial.github.io/sf/">sf</a>: Handles and manipulates geospatial data, enabling operations like reading, writing, transforming, and visualizing spatial data.</p></li>
<li><p><a href="https://www.tidyverse.org/">tidyverse</a>: A suite of R packages designed for data science tasks, including data manipulation, exploration, and visualization.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/sfdep/index.html">sfdep</a>: This package provides methods for measuring and diagnosing spatial dependence in linear regression models, particularly when working with spatial econometrics. It is tailored to work with ‘sf’ objects, which are used to handle spatial data in R.</p></li>
<li><p><a href="https://yihui.org/knitr/">knitr</a>: Allows for dynamic report generation with R, making it easy to integrate R code into reports and weave together narrative text and code output.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/Hmisc/index.html">Hmisc</a>: Contains many functions useful for data analysis, high-level graphics, utility operations, and functions for dealing with missing values.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/mapview/index.html">mapview</a>: Facilitates the interactive viewing of spatial data in R, built on top of Leaflet.js.</p></li>
<li><p><a href="https://rstudio.github.io/DT/">DT</a>: Provides an R interface to the JavaScript library DataTables, useful for creating interactive tables in R markdown documents and Shiny apps.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/sp/index.html">sp</a>: Provides classes and methods for spatial data, and has been superseded by <code>sf</code> but is still widely used for compatibility reasons.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/stplanr/index.html">stplanr</a>: Offers sustainable transport planning tools for spatial lines, networks, and movement data.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/reshape2/index.html">reshape2</a>: An R package that allows you to flexibly reshape data, such as melting and casting data frames.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/skimr/index.html">skimr</a>: Summarizes data in a frictionless way and produces a report with useful summary statistics.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/performance/index.html">performance</a>: Assesses the quality and performance of statistical models, including checks for assumptions.</p></li>
<li><p><a href="https://plotly.com/r/">plotly</a>: An R package that creates interactive web graphics using the plotly.js library.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/h3jsr/index.html">h3jsr</a>: Provides an R interface to Uber’s H3 spatial indexing system, allowing for the use of hexagonally-tiled maps.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/units/index.html">units</a>: Allows for the symbolic handling of measurement units in R.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/httr/index.html">httr</a>: Simplifies the process of working with HTTP requests, such as API calls.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/corrplot/index.html">corrplot</a>: Visualizes a correlation matrix, making it easier to understand the relationships between multiple variables.</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="data-import-and-minor-wrangling" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="data-import-and-minor-wrangling"><span class="header-section-number">2.2</span> Data Import and Minor Wrangling</h2>
<p>This section will import the required aspatial and geospatial dataset. The process also involves minor data change before going to more complex data wrangling in the next section.</p>
<section id="geospatial-1" class="level3">
<h3 class="anchored" data-anchor-id="geospatial-1">Geospatial</h3>
<p>the following panel will show how each geospatial dataset is imported, modify the CRS Code to 3414 to standardize, check on the data in general, check for duplicates, and display how the data looks like in Singapore map</p>
<div class="callout callout-style-default callout-note callout-titled" title="what is CRS Code?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
what is CRS Code?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Why 3414?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why 3414?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section id="mpsz" class="level4">
<h4 class="anchored" data-anchor-id="mpsz">MPSZ</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">'../data/geospatial'</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">layer=</span><span class="st">'MPSZ-2019'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MPSZ-2019' from data source `C:\ameernoor\ISSS624\data\geospatial' using driver `ESRI Shapefile'
Simple feature collection with 332 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775
Geodetic CRS:  WGS 84</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mpsz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 332
Columns: 7
$ SUBZONE_N  &lt;chr&gt; "MARINA EAST", "INSTITUTION HILL", "ROBERTSON QUAY", "JURON…
$ SUBZONE_C  &lt;chr&gt; "MESZ01", "RVSZ05", "SRSZ01", "WISZ01", "MUSZ02", "MPSZ05",…
$ PLN_AREA_N &lt;chr&gt; "MARINA EAST", "RIVER VALLEY", "SINGAPORE RIVER", "WESTERN …
$ PLN_AREA_C &lt;chr&gt; "ME", "RV", "SR", "WI", "MU", "MP", "WI", "WI", "SI", "SI",…
$ REGION_N   &lt;chr&gt; "CENTRAL REGION", "CENTRAL REGION", "CENTRAL REGION", "WEST…
$ REGION_C   &lt;chr&gt; "CR", "CR", "CR", "WR", "CR", "CR", "WR", "WR", "CR", "CR",…
$ geometry   &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((33222.98 29..., MULTIPOLYGON (…</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates based on unique id</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(mpsz<span class="sc">$</span>SUBZONE_N) <span class="sc">==</span> <span class="fu">nrow</span>(mpsz), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "no duplicates detected"</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set tmap mode (plot for lighter rendering, view for analysis)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># display the data in a map</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Singapore Planning Zone'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bus-stop-location-1" class="level4">
<h4 class="anchored" data-anchor-id="bus-stop-location-1">Bus Stop Location</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>busstop <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"../data/geospatial"</span>,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">layer =</span> <span class="st">"BusStop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `BusStop' from data source `C:\ameernoor\ISSS624\data\geospatial' using driver `ESRI Shapefile'
Simple feature collection with 5159 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3970.122 ymin: 26482.1 xmax: 48280.78 ymax: 52983.82
Projected CRS: SVY21</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(busstop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,159
Columns: 4
$ BUS_STOP_N &lt;chr&gt; "22069", "32071", "44331", "96081", "11561", "66191", "2338…
$ BUS_ROOF_N &lt;chr&gt; "B06", "B23", "B01", "B05", "B05", "B03", "B02A", "B02", "B…
$ LOC_DESC   &lt;chr&gt; "OPP CEVA LOGISTICS", "AFT TRACK 13", "BLK 239", "GRACE IND…
$ geometry   &lt;POINT [m]&gt; POINT (13576.31 32883.65), POINT (13228.59 44206.38),…</code></pre>
</div>
</div>
<p><em>BUS_STOP_N is used as the basis for duplicate checking because it will be the reference in joining the data</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates based on unique id</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(busstop<span class="sc">$</span>BUS_STOP_N) <span class="sc">==</span> <span class="fu">nrow</span>(busstop), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "possible duplicates detected"</code></pre>
</div>
</div>
<p>show the duplicates</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset rows where BUS_STOP_N has duplicates and arrange by BUS_STOP_N</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>duplicates <span class="ot">&lt;-</span> busstop[<span class="fu">duplicated</span>(busstop<span class="sc">$</span>BUS_STOP_N) <span class="sc">|</span> <span class="fu">duplicated</span>(busstop<span class="sc">$</span>BUS_STOP_N, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ] <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(BUS_STOP_N)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># show the number of duplicates</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(duplicates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the sorted rows with duplicate BUS_STOP_N</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(duplicates, <span class="at">n =</span> <span class="dv">32</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 30%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">BUS_STOP_N</th>
<th style="text-align: left;">BUS_ROOF_N</th>
<th style="text-align: left;">LOC_DESC</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">22501</td>
<td style="text-align: left;">B02</td>
<td style="text-align: left;">Blk 662A</td>
<td style="text-align: left;">POINT (13489.09 35536.4)</td>
</tr>
<tr class="even">
<td style="text-align: left;">22501</td>
<td style="text-align: left;">B02</td>
<td style="text-align: left;">BLK 662A</td>
<td style="text-align: left;">POINT (13488.02 35537.88)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">43709</td>
<td style="text-align: left;">B06</td>
<td style="text-align: left;">BLK 644</td>
<td style="text-align: left;">POINT (18963.42 36762.8)</td>
</tr>
<tr class="even">
<td style="text-align: left;">43709</td>
<td style="text-align: left;">B06</td>
<td style="text-align: left;">BLK 644</td>
<td style="text-align: left;">POINT (18952.02 36751.83)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">47201</td>
<td style="text-align: left;">UNK</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">POINT (22616.75 47793.68)</td>
</tr>
<tr class="even">
<td style="text-align: left;">47201</td>
<td style="text-align: left;">NIL</td>
<td style="text-align: left;">W’LANDS NTH STN</td>
<td style="text-align: left;">POINT (22632.92 47934)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">51071</td>
<td style="text-align: left;">B21</td>
<td style="text-align: left;">MACRITCHIE RESERVOIR</td>
<td style="text-align: left;">POINT (28300.11 36045.9)</td>
</tr>
<tr class="even">
<td style="text-align: left;">51071</td>
<td style="text-align: left;">B21</td>
<td style="text-align: left;">MACRITCHIE RESERVOIR</td>
<td style="text-align: left;">POINT (28305.37 36036.67)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">52059</td>
<td style="text-align: left;">B03</td>
<td style="text-align: left;">OPP BLK 65</td>
<td style="text-align: left;">POINT (30770.3 34460.06)</td>
</tr>
<tr class="even">
<td style="text-align: left;">52059</td>
<td style="text-align: left;">B09</td>
<td style="text-align: left;">BLK 219</td>
<td style="text-align: left;">POINT (30565.45 36133.15)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">53041</td>
<td style="text-align: left;">B05</td>
<td style="text-align: left;">Upp Thomson Road</td>
<td style="text-align: left;">POINT (28105.8 37246.76)</td>
</tr>
<tr class="even">
<td style="text-align: left;">53041</td>
<td style="text-align: left;">B07</td>
<td style="text-align: left;">Upp Thomson Road</td>
<td style="text-align: left;">POINT (27956.34 37379.29)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">58031</td>
<td style="text-align: left;">UNK</td>
<td style="text-align: left;">OPP CANBERRA DR</td>
<td style="text-align: left;">POINT (27089.69 47570.9)</td>
</tr>
<tr class="even">
<td style="text-align: left;">58031</td>
<td style="text-align: left;">UNK</td>
<td style="text-align: left;">OPP CANBERRA DR</td>
<td style="text-align: left;">POINT (27111.07 47517.77)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">62251</td>
<td style="text-align: left;">B03</td>
<td style="text-align: left;">Bef Blk 471B</td>
<td style="text-align: left;">POINT (35500.54 39943.41)</td>
</tr>
<tr class="even">
<td style="text-align: left;">62251</td>
<td style="text-align: left;">B03</td>
<td style="text-align: left;">BEF BLK 471B</td>
<td style="text-align: left;">POINT (35500.36 39943.34)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">67421</td>
<td style="text-align: left;">B01</td>
<td style="text-align: left;">CHENG LIM STN EXIT B</td>
<td style="text-align: left;">POINT (34548.54 42052.15)</td>
</tr>
<tr class="even">
<td style="text-align: left;">67421</td>
<td style="text-align: left;">NIL</td>
<td style="text-align: left;">CHENG LIM STN EXIT B</td>
<td style="text-align: left;">POINT (34741.77 42004.21)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">68091</td>
<td style="text-align: left;">B01</td>
<td style="text-align: left;">AFT BAKER ST</td>
<td style="text-align: left;">POINT (32164.11 42695.98)</td>
</tr>
<tr class="even">
<td style="text-align: left;">68091</td>
<td style="text-align: left;">B08</td>
<td style="text-align: left;">AFT BAKER ST</td>
<td style="text-align: left;">POINT (32038.84 43298.68)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">68099</td>
<td style="text-align: left;">B02</td>
<td style="text-align: left;">BEF BAKER ST</td>
<td style="text-align: left;">POINT (32154.9 42742.82)</td>
</tr>
<tr class="even">
<td style="text-align: left;">68099</td>
<td style="text-align: left;">B07</td>
<td style="text-align: left;">BEF BAKER ST</td>
<td style="text-align: left;">POINT (32004.05 43320.34)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">77329</td>
<td style="text-align: left;">B01</td>
<td style="text-align: left;">BEF PASIR RIS ST 53</td>
<td style="text-align: left;">POINT (40765.35 39452.18)</td>
</tr>
<tr class="even">
<td style="text-align: left;">77329</td>
<td style="text-align: left;">B03</td>
<td style="text-align: left;">Pasir Ris Central</td>
<td style="text-align: left;">POINT (40728.15 39438.15)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">82221</td>
<td style="text-align: left;">B01</td>
<td style="text-align: left;">BLK 3A</td>
<td style="text-align: left;">POINT (35323.6 33257.05)</td>
</tr>
<tr class="even">
<td style="text-align: left;">82221</td>
<td style="text-align: left;">B01</td>
<td style="text-align: left;">Blk 3A</td>
<td style="text-align: left;">POINT (35308.74 33335.17)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">96319</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Yusen Logistics</td>
<td style="text-align: left;">POINT (42187.23 34995.78)</td>
</tr>
<tr class="even">
<td style="text-align: left;">96319</td>
<td style="text-align: left;">NIL</td>
<td style="text-align: left;">YUSEN LOGISTICS</td>
<td style="text-align: left;">POINT (42187.23 34995.78)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">97079</td>
<td style="text-align: left;">B14</td>
<td style="text-align: left;">OPP ST. JOHN’S CRES</td>
<td style="text-align: left;">POINT (44144.57 38980.25)</td>
</tr>
<tr class="even">
<td style="text-align: left;">97079</td>
<td style="text-align: left;">B14</td>
<td style="text-align: left;">OPP ST. JOHN’S CRES</td>
<td style="text-align: left;">POINT (44055.75 38908.5)</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The folowing code chunk will execute the duplicate removal and show the result where number of rows have reduced from 5161 to 5145.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep one row of the duplicates in the original dataset</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>busstop <span class="ot">&lt;-</span> busstop[<span class="sc">!</span><span class="fu">duplicated</span>(busstop<span class="sc">$</span>BUS_STOP_N) <span class="sc">|</span> <span class="fu">duplicated</span>(busstop<span class="sc">$</span>BUS_STOP_N, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the resulting dataset</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(busstop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,144
Columns: 4
$ BUS_STOP_N &lt;chr&gt; "22069", "32071", "44331", "96081", "11561", "66191", "2338…
$ BUS_ROOF_N &lt;chr&gt; "B06", "B23", "B01", "B05", "B05", "B03", "B02A", "B02", "B…
$ LOC_DESC   &lt;chr&gt; "OPP CEVA LOGISTICS", "AFT TRACK 13", "BLK 239", "GRACE IND…
$ geometry   &lt;POINT [m]&gt; POINT (13576.31 32883.65), POINT (13228.59 44206.38),…</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set tmap mode (plot for lighter rendering, view for analysis)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the output</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(busstop)<span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>() <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Bus Stop Distribution Map'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="train-station" class="level4">
<h4 class="anchored" data-anchor-id="train-station">Train Station</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>station <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'../data/geospatial'</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">layer =</span> <span class="st">'RapidTransitSystemStation'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `RapidTransitSystemStation' from data source 
  `C:\ameernoor\ISSS624\data\geospatial' using driver `ESRI Shapefile'
Simple feature collection with 220 features and 4 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 6068.209 ymin: 27478.44 xmax: 45377.5 ymax: 47913.58
Projected CRS: SVY21</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the data contain non closed ring, use st_is_valid to fix</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>station <span class="ot">&lt;-</span> station <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">st_is_valid</span>(.))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(station)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 217
Columns: 5
$ TYP_CD     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ STN_NAM    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TYP_CD_DES &lt;chr&gt; "MRT", "MRT", "MRT", "MRT", "MRT", "LRT", "MRT", "MRT", "LR…
$ STN_NAM_DE &lt;chr&gt; "ESPLANADE MRT STATION", "PAYA LEBAR MRT STATION", "DHOBY G…
$ geometry   &lt;POLYGON [m]&gt; POLYGON ((30566.07 30621.21..., POLYGON ((34495.6 3…</code></pre>
</div>
</div>
<p><em>the duplicate consider geometry as the unique value</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates based on unique id</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(station<span class="sc">$</span>geometry) <span class="sc">==</span> <span class="fu">nrow</span>(station), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "no duplicates detected"</code></pre>
</div>
</div>
<p>all MRT Station location are unique</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the output</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">'white'</span>, <span class="at">alpha =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(station) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">'green'</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">'STN_NAM_DE'</span>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'MRT Station Distribution Map'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="train-exit" class="level4">
<h4 class="anchored" data-anchor-id="train-exit">Train Exit</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>trainexit <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'../data/geospatial'</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">layer =</span> <span class="st">'Train_Station_Exit_Layer'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Train_Station_Exit_Layer' from data source 
  `C:\ameernoor\ISSS624\data\geospatial' using driver `ESRI Shapefile'
Simple feature collection with 565 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 6134.086 ymin: 27499.7 xmax: 45356.36 ymax: 47865.92
Projected CRS: SVY21</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(trainexit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 565
Columns: 3
$ stn_name  &lt;chr&gt; "MACPHERSON MRT STATION", "MACPHERSON MRT STATION", "MACPHER…
$ exit_code &lt;chr&gt; "Exit A", "Exit B", "Exit C", "Exit B", "Exit A", "Exit A", …
$ geometry  &lt;POINT [m]&gt; POINT (34285.07 34322.99), POINT (34382.15 34231.9), P…</code></pre>
</div>
</div>
<p><em>the duplicate consider geometry as the unique value</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates based on unique id</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(trainexit<span class="sc">$</span>geometry) <span class="sc">==</span> <span class="fu">nrow</span>(trainexit), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "no duplicates detected"</code></pre>
</div>
</div>
<p>all MRT Station Exit location are unique</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(trainexit)<span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">'blue'</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">'exit_id'</span>) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Train Station Exit Distribution Map'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="business" class="level4">
<h4 class="anchored" data-anchor-id="business">Business</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>biz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"../data/geospatial"</span>,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">layer =</span> <span class="st">"Business"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Business' from data source `C:\ameernoor\ISSS624\data\geospatial' using driver `ESRI Shapefile'
Simple feature collection with 6550 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3669.148 ymin: 25408.41 xmax: 47034.83 ymax: 50148.54
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(biz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6,550
Columns: 4
$ POI_NAME   &lt;chr&gt; "JOHN CHEN", "TROPICAL INDUSTRIAL BUILDING", "LIAN CHEONG I…
$ POI_ST_NUM &lt;chr&gt; "6", "14", "12", NA, "2", "21", "68", "68", NA, "14", "10",…
$ POI_ST_NAM &lt;chr&gt; "LITTLE RD", "LITTLE RD", "LITTLE RD", NA, "LITTLE RD", "LO…
$ geometry   &lt;POINT [m]&gt; POINT (33818.36 35620.16), POINT (33770.51 35610.2), …</code></pre>
</div>
</div>
<p><em>considering some business might have branches, the duplicate condition here is only if all column value is the same</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates based on unique id</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(biz) <span class="sc">==</span> <span class="fu">nrow</span>(biz), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "possible duplicates detected"</code></pre>
</div>
</div>
<p>show the duplicates</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset rows where BUS_STOP_N has duplicates and arrange by BUS_STOP_N</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>duplicates <span class="ot">&lt;-</span> biz[<span class="fu">duplicated</span>(biz) <span class="sc">|</span> <span class="fu">duplicated</span>(biz, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ] <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(POI_NAME)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the sorted rows with duplicate BUS_STOP_N</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(duplicates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 27455.94 ymin: 28233.69 xmax: 27455.94 ymax: 28233.69
Projected CRS: SVY21 / Singapore TM
           POI_NAME POI_ST_NUM  POI_ST_NAM                  geometry
1 KEPPEL DISTRIPARK        511 KG BAHRU RD POINT (27455.94 28233.69)
2 KEPPEL DISTRIPARK        511 KG BAHRU RD POINT (27455.94 28233.69)</code></pre>
</div>
</div>
<p>The output shows that it really is the same business.</p>
<p>The folowing code chunk will execute the duplicate removal and show the result where number of rows have reduced from 6550 to 6549</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep one row of the duplicates in the original dataset</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>biz <span class="ot">&lt;-</span> biz[<span class="sc">!</span><span class="fu">duplicated</span>(biz) <span class="sc">|</span> <span class="fu">duplicated</span>(biz, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the resulting dataset</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(biz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6,549
Columns: 4
$ POI_NAME   &lt;chr&gt; "JOHN CHEN", "TROPICAL INDUSTRIAL BUILDING", "LIAN CHEONG I…
$ POI_ST_NUM &lt;chr&gt; "6", "14", "12", NA, "2", "21", "68", "68", NA, "14", "10",…
$ POI_ST_NAM &lt;chr&gt; "LITTLE RD", "LITTLE RD", "LITTLE RD", NA, "LITTLE RD", "LO…
$ geometry   &lt;POINT [m]&gt; POINT (33818.36 35620.16), POINT (33770.51 35610.2), …</code></pre>
</div>
</div>
<p>visualize the distribution on the map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the output</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.01</span>)<span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(biz)<span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Business Distribution Map'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="entertainment" class="level4">
<h4 class="anchored" data-anchor-id="entertainment">Entertainment</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>entertn <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'../data/geospatial'</span>,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">layer =</span> <span class="st">'entertn'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `entertn' from data source `C:\ameernoor\ISSS624\data\geospatial' using driver `ESRI Shapefile'
Simple feature collection with 114 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 10809.34 ymin: 26528.63 xmax: 41600.62 ymax: 46375.77
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(entertn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 114
Columns: 4
$ POI_NAME   &lt;chr&gt; "TP AUDITORIUM", "NP CONVENTION CENTRE", "SP AUDITORIUM", "…
$ POI_ST_NUM &lt;chr&gt; NA, NA, NA, "1", "350", NA, "201", NA, "83", "328", NA, "5"…
$ POI_ST_NAM &lt;chr&gt; NA, NA, NA, "FULLERTON SQ", "BALESTIER RD", "TRENGGANU ST",…
$ geometry   &lt;POINT [m]&gt; POINT (39115.71 36392.13), POINT (21533.12 34921.34),…</code></pre>
</div>
</div>
<p><em>considering some entertainment might have branches, the duplicate condition here is only if all column value is the same</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates based on unique id</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(entertn) <span class="sc">==</span> <span class="fu">nrow</span>(entertn), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "possible duplicates detected"</code></pre>
</div>
</div>
<p>show the duplicates</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset rows where BUS_STOP_N has duplicates and arrange by BUS_STOP_N</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>duplicates <span class="ot">&lt;-</span> entertn[<span class="fu">duplicated</span>(entertn) <span class="sc">|</span> <span class="fu">duplicated</span>(entertn, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ] <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(POI_NAME)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the sorted rows with duplicateW</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(duplicates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 30063.5 ymin: 30677.41 xmax: 30063.5 ymax: 30677.41
Projected CRS: SVY21 / Singapore TM
         POI_NAME POI_ST_NUM  POI_ST_NAM                 geometry
1 CAPITOL THEATRE         13 STAMFORD RD POINT (30063.5 30677.41)
2 CAPITOL THEATRE         13 STAMFORD RD POINT (30063.5 30677.41)</code></pre>
</div>
</div>
<p>The output shows that it really is the same entertainment</p>
<p>The folowing code chunk will execute the duplicate removal and show the result where number of rows have reduced from 114 to 113</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep one row of the duplicates in the original dataset</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>entertn <span class="ot">&lt;-</span> entertn[<span class="sc">!</span><span class="fu">duplicated</span>(entertn) <span class="sc">|</span> <span class="fu">duplicated</span>(entertn, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the resulting dataset</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(entertn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 113
Columns: 4
$ POI_NAME   &lt;chr&gt; "TP AUDITORIUM", "NP CONVENTION CENTRE", "SP AUDITORIUM", "…
$ POI_ST_NUM &lt;chr&gt; NA, NA, NA, "1", "350", NA, "201", NA, "83", "328", NA, "5"…
$ POI_ST_NAM &lt;chr&gt; NA, NA, NA, "FULLERTON SQ", "BALESTIER RD", "TRENGGANU ST",…
$ geometry   &lt;POINT [m]&gt; POINT (39115.71 36392.13), POINT (21533.12 34921.34),…</code></pre>
</div>
</div>
<p>visualize the distribution on the map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the output</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.01</span>)<span class="sc">+</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(entertn)<span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">'cyan'</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">'POI_NAME'</span>) <span class="sc">+</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Entertainment Distribution Map'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="food-beverage" class="level4">
<h4 class="anchored" data-anchor-id="food-beverage">Food &amp; Beverage</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>fnb <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'../data/geospatial'</span>,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">layer =</span> <span class="st">'F&amp;B'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `F&amp;B' from data source `C:\ameernoor\ISSS624\data\geospatial' using driver `ESRI Shapefile'
Simple feature collection with 1919 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 6010.495 ymin: 25343.27 xmax: 45462.43 ymax: 48796.21
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(fnb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,919
Columns: 4
$ POI_NAME   &lt;chr&gt; "KHEL", "I PUB", "LARK LOUNGE &amp; NITE-CLUB", "CHAKRAVARTHY",…
$ POI_ST_NUM &lt;chr&gt; "141", "14", "195", "195", "48", "36", "10", "697", "11", "…
$ POI_ST_NAM &lt;chr&gt; "KITCHENER RD", "CHUN TIN RD", "LAVENDER ST", "LAVENDER ST"…
$ geometry   &lt;POINT [m]&gt; POINT (30654.44 32466.51), POINT (21515.34 36007.18),…</code></pre>
</div>
</div>
<p><em>considering some F &amp; B might have branches, the duplicate condition here is only if all column value is the same</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates based on unique id</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(fnb) <span class="sc">==</span> <span class="fu">nrow</span>(fnb), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "no duplicates detected"</code></pre>
</div>
</div>
<p>visualize the distribution on the map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the output</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.01</span>)<span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(fnb)<span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">'magenta'</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">'POI_NAME'</span>) <span class="sc">+</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Food &amp; Beverage Distribution Map'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="financial-services" class="level4">
<h4 class="anchored" data-anchor-id="financial-services">Financial Services</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>finance <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'../data/geospatial'</span>,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">layer =</span> <span class="st">'FinServ'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `FinServ' from data source `C:\ameernoor\ISSS624\data\geospatial' using driver `ESRI Shapefile'
Simple feature collection with 3320 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 4881.527 ymin: 25171.88 xmax: 46526.16 ymax: 49338.02
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(finance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3,320
Columns: 4
$ POI_NAME   &lt;chr&gt; "UOB", "POSB", "UOB", "OCBC", "OCBC", "MAYBANK", "ADPOST MO…
$ POI_ST_NUM &lt;chr&gt; "201", "375", "375", "375", NA, "707", "163", NA, "11", NA,…
$ POI_ST_NAM &lt;chr&gt; "YISHUN AVE 2", "COMMONWEALTH AVE", "COMMONWEALTH AVE", "CO…
$ geometry   &lt;POINT [m]&gt; POINT (27966.77 44304.65), POINT (24163.96 31606.25),…</code></pre>
</div>
</div>
<p><em>considering some financial services might have branches, the duplicate condition here is only if all column value is the same</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates based on unique id</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(finance) <span class="sc">==</span> <span class="fu">nrow</span>(finance), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "possible duplicates detected"</code></pre>
</div>
</div>
<p>show the duplicates</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset rows for duplicates and arrange by POI_NAME and POI_ST_NAM</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>duplicates <span class="ot">&lt;-</span> finance[<span class="fu">duplicated</span>(finance) <span class="sc">|</span> <span class="fu">duplicated</span>(finance, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ] <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(POI_NAME, POI_ST_NAM)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the sorted rows with duplicatew</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(duplicates, <span class="at">n=</span><span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 30%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">POI_NAME</th>
<th style="text-align: left;">POI_ST_NUM</th>
<th style="text-align: left;">POI_ST_NAM</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ANZ</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">MARINE PARADE CENTRAL</td>
<td style="text-align: left;">POINT (36195.63 31542.21)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ANZ</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">MARINE PARADE CENTRAL</td>
<td style="text-align: left;">POINT (36195.63 31542.21)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ANZ</td>
<td style="text-align: left;">87</td>
<td style="text-align: left;">MARINE PARADE CENTRAL</td>
<td style="text-align: left;">POINT (36057.62 31668.26)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ANZ</td>
<td style="text-align: left;">87</td>
<td style="text-align: left;">MARINE PARADE CENTRAL</td>
<td style="text-align: left;">POINT (36057.62 31668.26)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ANZ</td>
<td style="text-align: left;">360</td>
<td style="text-align: left;">ORCHARD RD</td>
<td style="text-align: left;">POINT (27714.14 31996.56)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ANZ</td>
<td style="text-align: left;">360</td>
<td style="text-align: left;">ORCHARD RD</td>
<td style="text-align: left;">POINT (27714.14 31996.56)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ANZ</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">RAFFLES PL</td>
<td style="text-align: left;">POINT (30017.88 29712.09)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ANZ</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">RAFFLES PL</td>
<td style="text-align: left;">POINT (30017.88 29712.09)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BANK OF CHINA</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">BATTERY RD</td>
<td style="text-align: left;">POINT (30113.59 29758.53)</td>
</tr>
<tr class="even">
<td style="text-align: left;">BANK OF CHINA</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">BATTERY RD</td>
<td style="text-align: left;">POINT (30113.59 29758.53)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BANK OF CHINA</td>
<td style="text-align: left;">60</td>
<td style="text-align: left;">EU TONG SEN ST</td>
<td style="text-align: left;">POINT (29271.11 29829.29)</td>
</tr>
<tr class="even">
<td style="text-align: left;">BANK OF CHINA</td>
<td style="text-align: left;">60</td>
<td style="text-align: left;">EU TONG SEN ST</td>
<td style="text-align: left;">POINT (29271.11 29829.29)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BANK OF CHINA</td>
<td style="text-align: left;">133</td>
<td style="text-align: left;">MIDDLE RD</td>
<td style="text-align: left;">POINT (30189.25 31295.52)</td>
</tr>
<tr class="even">
<td style="text-align: left;">BANK OF CHINA</td>
<td style="text-align: left;">133</td>
<td style="text-align: left;">MIDDLE RD</td>
<td style="text-align: left;">POINT (30189.25 31295.52)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BANK OF CHINA</td>
<td style="text-align: left;">83</td>
<td style="text-align: left;">PUNGGOL CENTRAL</td>
<td style="text-align: left;">POINT (35606.57 43071.85)</td>
</tr>
<tr class="even">
<td style="text-align: left;">BANK OF CHINA</td>
<td style="text-align: left;">83</td>
<td style="text-align: left;">PUNGGOL CENTRAL</td>
<td style="text-align: left;">POINT (35606.57 43071.85)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CIMB BANK</td>
<td style="text-align: left;">270</td>
<td style="text-align: left;">ORCHARD RD</td>
<td style="text-align: left;">POINT (28308.43 31676.99)</td>
</tr>
<tr class="even">
<td style="text-align: left;">CIMB BANK</td>
<td style="text-align: left;">270</td>
<td style="text-align: left;">ORCHARD RD</td>
<td style="text-align: left;">POINT (28308.43 31676.99)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CIMB BANK</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">RAFFLES PL</td>
<td style="text-align: left;">POINT (30017.88 29712.09)</td>
</tr>
<tr class="even">
<td style="text-align: left;">CIMB BANK</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">RAFFLES PL</td>
<td style="text-align: left;">POINT (30017.88 29712.09)</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The output shows that it really is the same financial service</p>
<p>The folowing code chunk will execute the duplicate removal and show the result where number of rows have reduced from 3320 to 3058</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep one row of the duplicates in the original dataset</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>finance <span class="ot">&lt;-</span> finance[<span class="sc">!</span><span class="fu">duplicated</span>(finance) <span class="sc">|</span> <span class="fu">duplicated</span>(finance, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the resulting dataset</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(finance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3,058
Columns: 4
$ POI_NAME   &lt;chr&gt; "UOB", "POSB", "UOB", "OCBC", "OCBC", "MAYBANK", "ADPOST MO…
$ POI_ST_NUM &lt;chr&gt; "201", "375", "375", "375", NA, "707", "163", NA, "11", NA,…
$ POI_ST_NAM &lt;chr&gt; "YISHUN AVE 2", "COMMONWEALTH AVE", "COMMONWEALTH AVE", "CO…
$ geometry   &lt;POINT [m]&gt; POINT (27966.77 44304.65), POINT (24163.96 31606.25),…</code></pre>
</div>
</div>
<p>visualize the distribution on the map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the output</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.01</span>)<span class="sc">+</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(finance)<span class="sc">+</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">'black'</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">'POI_NAME'</span>) <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Financial Service Distribution Map'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="leisure-recreation" class="level4">
<h4 class="anchored" data-anchor-id="leisure-recreation">Leisure &amp; Recreation</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>lnr <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'../data/geospatial'</span>,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">layer =</span> <span class="st">'Liesure&amp;Recreation'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Liesure&amp;Recreation' from data source 
  `C:\ameernoor\ISSS624\data\geospatial' using driver `ESRI Shapefile'
Simple feature collection with 1217 features and 30 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 6010.495 ymin: 25134.28 xmax: 48439.77 ymax: 50078.88
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(lnr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,217
Columns: 31
$ LINK_ID    &lt;dbl&gt; 914885888, 1046871091, 845355245, 940657500, 940657500, 941…
$ POI_ID     &lt;dbl&gt; 1192316147, 1132324271, 1132324254, 1110521716, 1110521715,…
$ SEQ_NUM    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ FAC_TYPE   &lt;int&gt; 8410, 7997, 7997, 7997, 7997, 8410, 7997, 7997, 7997, 7997,…
$ POI_NAME   &lt;chr&gt; "NIE ART GALLERY", "ASPIRE CONCEPT", "SOCCERPUNTER", "ANAND…
$ POI_LANGCD &lt;chr&gt; "ENG", "ENG", "ENG", "ENG", "ENG", "ENG", "ENG", "ENG", "EN…
$ POI_NMTYPE &lt;chr&gt; "B", "B", "B", "B", "B", "B", "B", "J", "B", "B", "B", "B",…
$ POI_ST_NUM &lt;chr&gt; NA, "883", "14", "1", "1", "39", NA, NA, "108", "11", "11",…
$ ST_NUM_FUL &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "169A", NA, NA,…
$ ST_NFUL_LC &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "ENG", NA, NA, …
$ ST_NAME    &lt;chr&gt; "NANYANG CRES", "NORTH BRIDGE RD", "ROBINSON RD", "MARINE P…
$ ST_LANGCD  &lt;chr&gt; "ENG", "ENG", "ENG", "ENG", "ENG", "ENG", NA, NA, "ENG", "E…
$ POI_ST_SD  &lt;chr&gt; "R", "L", "L", "R", "R", "L", "R", "R", "L", "L", "L", "R",…
$ ACC_TYPE   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ PH_NUMBER  &lt;chr&gt; NA, "66347769", NA, NA, "63446164", "63327591", "67659324",…
$ CHAIN_ID   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ NAT_IMPORT &lt;chr&gt; "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N",…
$ PRIVATE    &lt;chr&gt; "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N",…
$ IN_VICIN   &lt;chr&gt; "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N",…
$ NUM_PARENT &lt;int&gt; 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 2, 0, 0, 0, 0,…
$ NUM_CHILD  &lt;int&gt; 0, 0, 0, 0, 0, 0, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,…
$ PERCFRREF  &lt;int&gt; NA, NA, NA, 43, 43, 51, 40, 40, NA, NA, 40, 99, 59, 15, NA,…
$ VANCITY_ID &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ ACT_ADDR   &lt;chr&gt; NA, NA, NA, NA, NA, NA, "1 CHOA CHU KANG STREET 53         …
$ ACT_LANGCD &lt;chr&gt; NA, NA, NA, NA, NA, NA, "ENG", "ENG", NA, NA, NA, NA, NA, N…
$ ACT_ST_NAM &lt;chr&gt; NA, NA, NA, NA, NA, NA, "CHOA CHU KANG STREET 53", "CHOA CH…
$ ACT_ST_NUM &lt;chr&gt; NA, NA, NA, NA, NA, NA, "1", "1", NA, NA, NA, NA, NA, NA, N…
$ ACT_ADMIN  &lt;chr&gt; NA, NA, NA, NA, NA, NA, "SINGAPORE", "SINGAPORE", NA, NA, N…
$ ACT_POSTAL &lt;chr&gt; NA, NA, NA, NA, NA, NA, "689236", "689236", NA, NA, NA, NA,…
$ ENTR_TYPE  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ geometry   &lt;POINT [m]&gt; POINT (10664.66 36585.97), POINT (31490.24 32040.81),…</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(lnr<span class="sc">$</span>LINK_ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 908</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(lnr<span class="sc">$</span>POI_ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1141</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(lnr<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 988</code></pre>
</div>
</div>
<p><em>considering some leisure &amp; recreation might have branches, the duplicate condition here is only if all column value is the same</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates based on unique id</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(lnr) <span class="sc">==</span> <span class="fu">nrow</span>(lnr), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "no duplicates detected"</code></pre>
</div>
</div>
<p>visualize the distribution on the map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the output</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.01</span>)<span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(lnr)<span class="sc">+</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">'coral'</span>,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">'POI_NAME'</span>) <span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Leisure &amp; Recreation Distribution Map'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="retails" class="level4">
<h4 class="anchored" data-anchor-id="retails">Retails</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>retails <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'../data/geospatial'</span>,</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">layer =</span> <span class="st">'Retails'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Retails' from data source `C:\ameernoor\ISSS624\data\geospatial' using driver `ESRI Shapefile'
Simple feature collection with 37635 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 4737.982 ymin: 25171.88 xmax: 48265.04 ymax: 50135.28
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(retails)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 37,635
Columns: 4
$ POI_NAME   &lt;chr&gt; "TIAN KEE &amp; CO", "PEOPLE TRADITIONAL CHINESE MEDICAL", "RIV…
$ POI_ST_NUM &lt;chr&gt; "12", "12", NA, NA, "588", "243", "208", "267", "231", "158…
$ POI_ST_NAM &lt;chr&gt; "DAKOTA CRES", "DAKOTA CRES", NA, NA, "SERANGOON RD", "ALEX…
$ geometry   &lt;POINT [m]&gt; POINT (33713.83 32023.15), POINT (33713.83 32023.15),…</code></pre>
</div>
</div>
<p><em>considering some financial services might have branches, the duplicate condition here is only if all column value is the same</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates based on unique id</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(retails) <span class="sc">==</span> <span class="fu">nrow</span>(retails), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "possible duplicates detected"</code></pre>
</div>
</div>
<p>show the duplicates</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset rows for duplicates and arrange by POI_NAME and POI_ST_NAM</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>duplicates <span class="ot">&lt;-</span> retails[<span class="fu">duplicated</span>(retails) <span class="sc">|</span> <span class="fu">duplicated</span>(retails, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ] <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(POI_NAME, POI_ST_NAM)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the sorted rows with duplicatew</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(duplicates, <span class="at">n=</span><span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 31%">
<col style="width: 13%">
<col style="width: 22%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">POI_NAME</th>
<th style="text-align: left;">POI_ST_NUM</th>
<th style="text-align: left;">POI_ST_NAM</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10 &amp; 10 SPORTING CO.</td>
<td style="text-align: left;">28</td>
<td style="text-align: left;">KALLANG PL</td>
<td style="text-align: left;">POINT (31757.32 33054.78)</td>
</tr>
<tr class="even">
<td style="text-align: left;">10 &amp; 10 SPORTING CO.</td>
<td style="text-align: left;">28</td>
<td style="text-align: left;">KALLANG PL</td>
<td style="text-align: left;">POINT (31757.32 33054.78)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">123 SALES</td>
<td style="text-align: left;">662</td>
<td style="text-align: left;">BUFFALO RD</td>
<td style="text-align: left;">POINT (29895.44 32149.16)</td>
</tr>
<tr class="even">
<td style="text-align: left;">123 SALES</td>
<td style="text-align: left;">662</td>
<td style="text-align: left;">BUFFALO RD</td>
<td style="text-align: left;">POINT (29895.44 32149.16)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AIK BAN HENG &amp; TRADING</td>
<td style="text-align: left;">456</td>
<td style="text-align: left;">ANG MO KIO AVE 10</td>
<td style="text-align: left;">POINT (30820.2 38832.31)</td>
</tr>
<tr class="even">
<td style="text-align: left;">AIK BAN HENG &amp; TRADING</td>
<td style="text-align: left;">456</td>
<td style="text-align: left;">ANG MO KIO AVE 10</td>
<td style="text-align: left;">POINT (30820.2 38832.31)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AIK KIONG ENGINEERING CO</td>
<td style="text-align: left;">90</td>
<td style="text-align: left;">DUNLOP ST</td>
<td style="text-align: left;">POINT (30182.57 31993.25)</td>
</tr>
<tr class="even">
<td style="text-align: left;">AIK KIONG ENGINEERING CO</td>
<td style="text-align: left;">90</td>
<td style="text-align: left;">DUNLOP ST</td>
<td style="text-align: left;">POINT (30182.57 31993.25)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ALEXANDRA CENTRAL</td>
<td style="text-align: left;">321</td>
<td style="text-align: left;">ALEXANDRA RD</td>
<td style="text-align: left;">POINT (24837.25 30020.6)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ALEXANDRA CENTRAL</td>
<td style="text-align: left;">321</td>
<td style="text-align: left;">ALEXANDRA RD</td>
<td style="text-align: left;">POINT (24837.25 30020.6)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ANACAONA</td>
<td style="text-align: left;">128</td>
<td style="text-align: left;">DUNLOP ST</td>
<td style="text-align: left;">POINT (30113.57 32037.48)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ANACAONA</td>
<td style="text-align: left;">128</td>
<td style="text-align: left;">DUNLOP ST</td>
<td style="text-align: left;">POINT (30113.57 32037.48)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ANTECH INTERNET CAFE</td>
<td style="text-align: left;">44</td>
<td style="text-align: left;">UPP DICKSON RD</td>
<td style="text-align: left;">POINT (30170.33 32060.7)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ANTECH INTERNET CAFE</td>
<td style="text-align: left;">44</td>
<td style="text-align: left;">UPP DICKSON RD</td>
<td style="text-align: left;">POINT (30170.33 32060.7)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BABY GUESS</td>
<td style="text-align: left;">290</td>
<td style="text-align: left;">ORCHARD RD</td>
<td style="text-align: left;">POINT (28306.21 31787.57)</td>
</tr>
<tr class="even">
<td style="text-align: left;">BABY GUESS</td>
<td style="text-align: left;">290</td>
<td style="text-align: left;">ORCHARD RD</td>
<td style="text-align: left;">POINT (28306.21 31787.57)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BAN CHOON MEDICAL STORE</td>
<td style="text-align: left;">130</td>
<td style="text-align: left;">TELOK AYER ST</td>
<td style="text-align: left;">POINT (29649.5 29342.76)</td>
</tr>
<tr class="even">
<td style="text-align: left;">BAN CHOON MEDICAL STORE</td>
<td style="text-align: left;">130</td>
<td style="text-align: left;">TELOK AYER ST</td>
<td style="text-align: left;">POINT (29649.5 29342.76)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BANG &amp; OLUFSEN</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">SCOTTS RD</td>
<td style="text-align: left;">POINT (27957.87 32092.76)</td>
</tr>
<tr class="even">
<td style="text-align: left;">BANG &amp; OLUFSEN</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">SCOTTS RD</td>
<td style="text-align: left;">POINT (27957.87 32092.76)</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The output indicates that it really is the same retail business</p>
<p>The folowing code chunk will execute the duplicate removal and show the result where number of rows have reduced from 37635 to 37463</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep one row of the duplicates in the original dataset</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>retails <span class="ot">&lt;-</span> retails[<span class="sc">!</span><span class="fu">duplicated</span>(retails) <span class="sc">|</span> <span class="fu">duplicated</span>(retails, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the resulting dataset</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(retails)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 37,463
Columns: 4
$ POI_NAME   &lt;chr&gt; "TIAN KEE &amp; CO", "PEOPLE TRADITIONAL CHINESE MEDICAL", "RIV…
$ POI_ST_NUM &lt;chr&gt; "12", "12", NA, NA, "588", "243", "208", "267", "231", "158…
$ POI_ST_NAM &lt;chr&gt; "DAKOTA CRES", "DAKOTA CRES", NA, NA, "SERANGOON RD", "ALEX…
$ geometry   &lt;POINT [m]&gt; POINT (33713.83 32023.15), POINT (33713.83 32023.15),…</code></pre>
</div>
</div>
<p>visualize the distribution on the map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the output</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(finance) <span class="sc">+</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">'lightcoral'</span>, <span class="at">id =</span> <span class="st">'POI_NAME'</span>) <span class="sc">+</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title=</span><span class="st">"Retail Distribution Map"</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>:::</p>
</section>
</section>
<section id="aspatial-1" class="level3">
<h3 class="anchored" data-anchor-id="aspatial-1">Aspatial</h3>
<p>This subsection will import the aspatial data used in this project and check it. The data includes Passenger Volume by Origin Destination Bus Stops and HDB data which explanations can be found in previous section.</p>
<section id="passenger-volume" class="level4">
<h4 class="anchored" data-anchor-id="passenger-volume">Passenger Volume</h4>
<p>Firstly, the following code will import the Passenger Volume by Origin Destination Bus Stops dataset. At the same time, it will also set the reference bus stop code data type to <code>factor</code> for easing compatibility issue and more efficient processing. As previously mentioned, this project will focus on weekday morning peak, so the code will also filter the data by that criteria, grouping it using the reference column, while summing the total trip for each unique grouped reference value. Finally, the code will generate output of summary statistics of the resulting dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load csv file</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>odb10 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/aspatial/origin_destination_bus_202310.csv.gz"</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co"># change georeference data type into factors</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>odb10 <span class="ot">&lt;-</span> odb10 <span class="sc">%&gt;%</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ORIGIN_PT_CODE =</span> <span class="fu">as.factor</span>(ORIGIN_PT_CODE),</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">DESTINATION_PT_CODE =</span> <span class="fu">as.factor</span>(DESTINATION_PT_CODE)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="co"># filter and group the data</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>odb10 <span class="ot">&lt;-</span> odb10 <span class="sc">%&gt;%</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DAY_TYPE <span class="sc">==</span> <span class="st">"WEEKDAY"</span>, </span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>         TIME_PER_HOUR <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">&amp;</span> TIME_PER_HOUR <span class="sc">&lt;=</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ORIGIN_PT_CODE, DESTINATION_PT_CODE) <span class="sc">%&gt;%</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TRIPS =</span> <span class="fu">sum</span>(TOTAL_TRIPS))</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a><span class="co"># check the summary statistics of resulting dataframe</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(odb10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>odb10 

 3  Variables      242208  Observations
--------------------------------------------------------------------------------
ORIGIN_PT_CODE 
       n  missing distinct 
  242208        0     5029 

lowest : 01012 01013 01019 01029 01039, highest: 99139 99161 99171 99181 99189
--------------------------------------------------------------------------------
DESTINATION_PT_CODE 
       n  missing distinct 
  242208        0     5043 

lowest : 01012 01013 01019 01029 01039, highest: 99139 99161 99171 99181 99189
--------------------------------------------------------------------------------
TRIPS 
       n  missing distinct     Info     Mean      Gmd      .05      .10 
  242208        0     3335    0.997    107.2    180.8        1        1 
     .25      .50      .75      .90      .95 
       3       15       57      187      373 

lowest :     1     2     3     4     5, highest: 41201 46505 72829 74796 97600
--------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Functions">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Functions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a> from <strong>readr</strong> package reads a CSV file into R, converting it to a data frame.</li>
<li><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a> from <strong>dplyr</strong> package is used to add new variables to a data frame or modify existing ones. Here, it converts <code>ORIGIN_PT_CODE</code> and <code>DESTINATION_PT_CODE</code> to factors.</li>
<li><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a> from <strong>dplyr</strong> package is used to subset rows based on specified conditions. In this code, it filters data for weekdays during morning peak hours (6 to 9 AM).</li>
<li><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a> from <strong>dplyr</strong> package groups the data by specified columns, here by <code>ORIGIN_PT_CODE</code> and <code>DESTINATION_PT_CODE</code>.</li>
<li><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a> from <strong>dplyr</strong> package calculates summary statistics for each group, in this case summing up <code>TOTAL_TRIPS</code>.</li>
<li><a href="https://www.rdocumentation.org/packages/Hmisc/versions/4.4-0/topics/describe">describe</a> from <strong>Hmisc</strong> package provides a detailed summary of an object’s contents, typically offering statistics like mean, standard deviation, frequency, and others.</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="How to Read the Output?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How to Read the Output?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The data provides details about the origin and destination points, along with the corresponding number of total trips, time information, and categorization based on day types. The variable summaries indicate the data distribution, with details such as the unique values, frequency, and descriptive statistics for each column.</p>
</div>
</div>
</div>
</section>
<section id="hdb-1" class="level4">
<h4 class="anchored" data-anchor-id="hdb-1">HDB</h4>
<p>For the HDB dataset</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load csv file</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>hdb <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/aspatial/hdb.csv"</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(hdb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 12,442
Columns: 37
$ ...1                  &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14…
$ blk_no                &lt;chr&gt; "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"…
$ street                &lt;chr&gt; "BEACH RD", "BEDOK STH AVE 1", "CANTONMENT RD", …
$ max_floor_lvl         &lt;dbl&gt; 16, 14, 2, 15, 4, 25, 12, 14, 12, 2, 15, 15, 13,…
$ year_completed        &lt;dbl&gt; 1970, 1975, 2010, 1982, 1975, 1982, 1975, 1977, …
$ residential           &lt;chr&gt; "Y", "Y", "N", "Y", "Y", "Y", "Y", "Y", "Y", "N"…
$ commercial            &lt;chr&gt; "Y", "N", "Y", "N", "Y", "N", "N", "N", "Y", "Y"…
$ market_hawker         &lt;chr&gt; "N", "N", "N", "N", "N", "N", "N", "N", "N", "N"…
$ miscellaneous         &lt;chr&gt; "N", "Y", "N", "N", "N", "N", "Y", "Y", "N", "N"…
$ multistorey_carpark   &lt;chr&gt; "N", "N", "N", "N", "N", "N", "N", "N", "N", "N"…
$ precinct_pavilion     &lt;chr&gt; "N", "N", "N", "N", "N", "N", "N", "N", "N", "N"…
$ bldg_contract_town    &lt;chr&gt; "KWN", "BD", "CT", "BD", "PRC", "BM", "QT", "GL"…
$ total_dwelling_units  &lt;dbl&gt; 142, 206, 0, 102, 55, 96, 125, 247, 95, 0, 220, …
$ `1room_sold`          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ `2room_sold`          &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ `3room_sold`          &lt;dbl&gt; 138, 204, 0, 0, 54, 0, 118, 0, 62, 0, 216, 214, …
$ `4room_sold`          &lt;dbl&gt; 1, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ `5room_sold`          &lt;dbl&gt; 2, 2, 0, 92, 1, 96, 7, 0, 33, 0, 4, 5, 0, 4, 0, …
$ exec_sold             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ multigen_sold         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ studio_apartment_sold &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ `1room_rental`        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 319, 0, 0, 0…
$ `2room_rental`        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 247, 0, 0, 0, 0, 0, 0, 56, …
$ `3room_rental`        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14, 1,…
$ other_room_rental     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14, 0,…
$ lat                   &lt;dbl&gt; 1.295097, 1.320852, 1.275488, 1.327969, 1.388610…
$ lng                   &lt;dbl&gt; 103.8541, 103.9337, 103.8414, 103.9227, 103.9881…
$ building              &lt;chr&gt; "RAFFLES HOTEL", "NIL", "PINNACLE @ DUXTON", "PI…
$ addr                  &lt;chr&gt; "1 BEACH ROAD RAFFLES HOTEL SINGAPORE 189673", "…
$ postal                &lt;chr&gt; "189673", "460001", "080001", "461001", "500001"…
$ SUBZONE_NO            &lt;dbl&gt; 2, 6, 3, 3, 1, 9, 10, 5, 3, 5, 1, 5, 2, 2, 1, 7,…
$ SUBZONE_N             &lt;chr&gt; "CITY HALL", "BEDOK SOUTH", "CHINATOWN", "KEMBAN…
$ SUBZONE_C             &lt;chr&gt; "DTSZ02", "BDSZ06", "OTSZ03", "BDSZ03", "CHSZ01"…
$ PLN_AREA_N            &lt;chr&gt; "DOWNTOWN CORE", "BEDOK", "OUTRAM", "BEDOK", "CH…
$ PLN_AREA_C            &lt;chr&gt; "DT", "BD", "OT", "BD", "CH", "BM", "QT", "GL", …
$ REGION_N              &lt;chr&gt; "CENTRAL REGION", "EAST REGION", "CENTRAL REGION…
$ REGION_C              &lt;chr&gt; "CR", "ER", "CR", "ER", "ER", "CR", "CR", "CR", …</code></pre>
</div>
</div>
<p>visualize the distribution</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>hdb_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(hdb,</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>),</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the output</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">'white'</span>, <span class="at">alpha =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hdb_sf) <span class="sc">+</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">'lightblue'</span>,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">'building'</span>) <span class="sc">+</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'HDB Distribution Map'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="school-1" class="level4">
<h4 class="anchored" data-anchor-id="school-1">School</h4>
<p>For the School dataset</p>
<p>Geocoding is the conversion of an address or postal code into geographic coordinates, typically latitude and longitude. The Singapore Land Authority offers the <a href="https://www.onemap.gov.sg/apidocs/">OneMap API</a>, specifically the <a href="https://www.onemap.gov.sg/apidocs/apidocs">Search</a> API, which retrieves latitude, longitude, and x,y coordinates for a given address or postal code.</p>
<p>To perform geocoding using the <a href="https://www.onemap.gov.sg/docs/#onemap-rest-apis">SLA OneMap API</a>, the provided code, written in R, reads input data from a CSV file using the <em>read_csv</em> function from the <strong>readr</strong> package. The <strong>httr</strong> package’s HTTP call functions are then used to send individual records to the OneMap geocoding server.</p>
<p>The geocoding process creates two data frames: <code>found</code> for successfully geocoded records and <code>not_found</code> for those that failed. The <code>found</code> data table is joined with the initial CSV data table using a unique identifier (POSTAL) and saved as a new CSV file named <code>found</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.onemap.gov.sg/api/common/elastic/search"</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>csv <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/aspatial/Generalinformationofschools.csv"</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>postcodes <span class="ot">&lt;-</span> csv<span class="sc">$</span>postal_code</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>found <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>not_found <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(postcode <span class="cf">in</span> postcodes){</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  query <span class="ot">&lt;-</span><span class="fu">list</span>(<span class="st">'searchVal'</span> <span class="ot">=</span> postcode, <span class="st">'returnGeom'</span><span class="ot">=</span><span class="st">'Y'</span>, <span class="st">'getAddrDetails'</span><span class="ot">=</span><span class="st">'Y'</span>, <span class="st">'pageNum'</span> <span class="ot">=</span> <span class="st">'1'</span>)</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  res  <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query=</span>query)</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>((<span class="fu">content</span>(res)<span class="sc">$</span>found)<span class="sc">!=</span><span class="dv">0</span>)</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>    found<span class="ot">&lt;-</span><span class="fu">rbind</span>(found, <span class="fu">data.frame</span>(<span class="fu">content</span>(res))[<span class="dv">4</span><span class="sc">:</span><span class="dv">13</span>])</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>  not_found <span class="ot">=</span> <span class="fu">data.frame</span>(postcode)</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(found)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 345
Columns: 10
$ results.SEARCHVAL &lt;chr&gt; "THE LEARNING HARBOUR @ ADMIRALTY PRIMARY SCHOOL", "…
$ results.BLK_NO    &lt;chr&gt; "11", "31", "10", "751", "100", "2A", "31", "19", "1…
$ results.ROAD_NAME &lt;chr&gt; "WOODLANDS CIRCLE", "WOODLANDS CRESCENT", "YISHUN ST…
$ results.BUILDING  &lt;chr&gt; "THE LEARNING HARBOUR @ ADMIRALTY PRIMARY SCHOOL", "…
$ results.ADDRESS   &lt;chr&gt; "11 WOODLANDS CIRCLE THE LEARNING HARBOUR @ ADMIRALT…
$ results.POSTAL    &lt;chr&gt; "738907", "737916", "768643", "768928", "579646", "1…
$ results.X         &lt;chr&gt; "24315.9398124339", "24559.0472937012", "27958.13714…
$ results.Y         &lt;chr&gt; "47135.3542042952", "47504.7873554379", "46096.26276…
$ results.LATITUDE  &lt;chr&gt; "1.44254963931583", "1.44589068910993", "1.433152715…
$ results.LONGITUDE &lt;chr&gt; "103.800213682734", "103.802398196596", "103.8329424…</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">=</span> <span class="fu">merge</span>(csv, found, <span class="at">by.x =</span> <span class="st">'postal_code'</span>, <span class="at">by.y =</span> <span class="st">'results.POSTAL'</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># manually add the Zhenghua Secondary School data</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>schools[schools<span class="sc">$</span>school_name <span class="sc">==</span> <span class="st">"ZHENGHUA SECONDARY SCHOOL"</span>, <span class="st">"results.LATITUDE"</span>] <span class="ot">&lt;-</span> <span class="fl">1.3887</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>schools[schools<span class="sc">$</span>school_name <span class="sc">==</span> <span class="st">"ZHENGHUA SECONDARY SCHOOL"</span>, <span class="st">"results.LONGITUDE"</span>] <span class="ot">&lt;-</span> <span class="fl">103.7652</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co"># check the output</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(schools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 350
Columns: 40
$ postal_code        &lt;chr&gt; "088256", "099138", "099757", "099840", "109100", "…
$ school_name        &lt;chr&gt; "CANTONMENT PRIMARY SCHOOL", "CHIJ ST. THERESA'S CO…
$ url_address        &lt;chr&gt; "http://www.cantonmentpri.moe.edu.sg", "http://www.…
$ address            &lt;chr&gt; "1    Cantonment Close", "160  LOWER DELTA ROAD", "…
$ telephone_no       &lt;chr&gt; "65119555", "64775777", "62730096", "62733937", "62…
$ telephone_no_2     &lt;chr&gt; "na", "na", "na", "na", "na", "na", "na", "na", "na…
$ fax_no             &lt;chr&gt; "65119556", "64775700", "62731710", "62763083", "62…
$ fax_no_2           &lt;chr&gt; "na", "na", "na", "na", "na", "na", "na", "na", "na…
$ email_address      &lt;chr&gt; "cantonment_ps@moe.edu.sg", "CHIJSTCS@MOE.EDU.SG", …
$ mrt_desc           &lt;chr&gt; "Tanjong Pagar Outram Park", "HARBOURFRONT MRT, TIO…
$ bus_desc           &lt;chr&gt; "75, 167, 196", "65, 121, 123, 123M, 124, 131, 131M…
$ principal_name     &lt;chr&gt; "MRS MANOKARA SUGUNAVATHI", "MDM TAN MEI MEI JENNY"…
$ first_vp_name      &lt;chr&gt; "MRS AUDREA CHIN", "MDM ONG LEE LEE", "MS NG CHIOU …
$ second_vp_name     &lt;chr&gt; "MISS CHENG SHIN MIIN", "MISS KUO ZHAOYAN, FELICIA"…
$ third_vp_name      &lt;chr&gt; "NULL", "NULL", "NULL", "NULL", "NULL", "NULL", "NU…
$ fourth_vp_name     &lt;chr&gt; "NULL", "NULL", "NULL", "NULL", "NULL", "NULL", "NU…
$ fifth_vp_name      &lt;chr&gt; "NULL", "NULL", "NULL", "NULL", "NULL", "NULL", "NU…
$ sixth_vp_name      &lt;chr&gt; "NULL", "NULL", "NULL", "NULL", "NULL", "NULL", "NU…
$ dgp_code           &lt;chr&gt; "BUKIT MERAH", "BUKIT MERAH", "BUKIT MERAH", "BUKIT…
$ zone_code          &lt;chr&gt; "SOUTH", "SOUTH", "SOUTH", "SOUTH", "SOUTH", "SOUTH…
$ type_code          &lt;chr&gt; "GOVERNMENT SCHOOL", "GOVERNMENT-AIDED SCH", "GOVER…
$ nature_code        &lt;chr&gt; "CO-ED SCHOOL", "GIRLS' SCHOOL", "GIRLS' SCHOOL", "…
$ session_code       &lt;chr&gt; "SINGLE SESSION", "SINGLE SESSION", "SINGLE SESSION…
$ mainlevel_code     &lt;chr&gt; "PRIMARY", "SECONDARY", "PRIMARY", "PRIMARY", "PRIM…
$ sap_ind            &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "Ye…
$ autonomous_ind     &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No…
$ gifted_ind         &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "Ye…
$ ip_ind             &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No…
$ mothertongue1_code &lt;chr&gt; "Chinese", "Chinese", "Chinese", "Chinese", "Chines…
$ mothertongue2_code &lt;chr&gt; "Malay", "Malay", "Malay", "Malay", "Malay", "Malay…
$ mothertongue3_code &lt;chr&gt; "Tamil", "Tamil", "Tamil", "Tamil", "Tamil", "na", …
$ results.SEARCHVAL  &lt;chr&gt; "KIDZ TREEHOUSE @ CANTONMENT", "CHIJ SAINT THERESA'…
$ results.BLK_NO     &lt;chr&gt; "1", "160", "1", "1", "91", "147", "301", "50", "30…
$ results.ROAD_NAME  &lt;chr&gt; "CANTONMENT CLOSE", "LOWER DELTA ROAD", "BUKIT TERE…
$ results.BUILDING   &lt;chr&gt; "KIDZ TREEHOUSE @ CANTONMENT", "CHIJ SAINT THERESA'…
$ results.ADDRESS    &lt;chr&gt; "1 CANTONMENT CLOSE KIDZ TREEHOUSE @ CANTONMENT SIN…
$ results.X          &lt;chr&gt; "28748.1620587641", "26789.3781491434", "27402.9654…
$ results.Y          &lt;chr&gt; "28659.9995642845", "28647.4426490944", "28579.8478…
$ results.LATITUDE   &lt;chr&gt; "1.27546534984202", "1.27535177510054", "1.27474048…
$ results.LONGITUDE  &lt;chr&gt; "103.840041087946", "103.822440701642", "103.827954…</code></pre>
</div>
</div>
<p>visualize the distribution</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>schools_sf <span class="ot">&lt;-</span> schools <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="st">"results.LATITUDE"</span>,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="st">"results.LONGITUDE"</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    postal_code, </span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    school_name, </span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    latitude, </span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    longitude</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs=</span><span class="dv">4326</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">3414</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the output</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">'white'</span>, <span class="at">alpha =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(schools_sf) <span class="sc">+</span></span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">'lightgreen'</span>,</span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">'building'</span>) <span class="sc">+</span></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Schools Distribution Map'</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="data-wrangling" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data Wrangling</h1>
<section id="create-hexagon-layer" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="create-hexagon-layer"><span class="header-section-number">3.1</span> Create Hexagon Layer</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create hexagonal grid based on bus stop locations</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>hexagonal_grid <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(busstop,</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">cellsize =</span> <span class="dv">750</span>,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">what =</span> <span class="st">"polygons"</span>,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">square =</span> <span class="cn">FALSE</span>)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert hexagonal grid to spatial dataframe</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>hex_grid_sf <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">hex_grid =</span> hexagonal_grid) <span class="sc">%&gt;%</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hexagon_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">lengths</span>(hexagonal_grid)))</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of bus stops within each hexagon</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>hex_grid_sf<span class="sc">$</span>num_bus_stops <span class="ot">=</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(hex_grid_sf, busstop))</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter hexagons with at least one bus stop</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>hexagons_with_bus_stops <span class="ot">&lt;-</span> <span class="fu">filter</span>(hex_grid_sf, num_bus_stops <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a><span class="co"># check the output</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(hexagons_with_bus_stops)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 834
Columns: 3
$ hex_grid      &lt;POLYGON [m]&gt; POLYGON ((3970.122 27348.13..., POLYGON ((4345.1…
$ hexagon_id    &lt;int&gt; 23, 44, 46, 66, 67, 68, 86, 87, 88, 89, 90, 109, 110, 11…
$ num_bus_stops &lt;int&gt; 1, 1, 2, 1, 4, 1, 1, 1, 4, 2, 1, 3, 2, 5, 2, 1, 1, 5, 3,…</code></pre>
</div>
</div>
<p>visualize the output</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the number of bus stops per hexagon with a color gradient and legend</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hexagons_with_bus_stops) <span class="sc">+</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"num_bus_stops"</span>,</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Bus Stop Density"</span>,</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"jenks"</span>,</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"YlOrRd"</span>,</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.show =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Bus Stop Density in Hexagonal Grid'</span>,</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="combine-bus-stop-and-hexagon" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="combine-bus-stop-and-hexagon"><span class="header-section-number">3.2</span> Combine Bus Stop and Hexagon</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a spatial join</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>busstop_with_hex_info <span class="ot">&lt;-</span> <span class="fu">st_join</span>(busstop, hexagons_with_bus_stops, <span class="at">by =</span> <span class="cn">NULL</span>, <span class="at">join =</span> st_within)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the relevant columns</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>busstop_with_hex_info <span class="ot">&lt;-</span> busstop_with_hex_info <span class="sc">%&gt;%</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(BUS_STOP_N, BUS_ROOF_N, LOC_DESC, hexagon_id, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">BUS_STOP_N =</span> <span class="fu">as.factor</span>(BUS_STOP_N)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the resulting data</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(busstop_with_hex_info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,144
Columns: 5
$ BUS_STOP_N &lt;fct&gt; 22069, 32071, 44331, 96081, 11561, 66191, 23389, 54411, 285…
$ BUS_ROOF_N &lt;chr&gt; "B06", "B23", "B01", "B05", "B05", "B03", "B02A", "B02", "B…
$ LOC_DESC   &lt;chr&gt; "OPP CEVA LOGISTICS", "AFT TRACK 13", "BLK 239", "GRACE IND…
$ hexagon_id &lt;int&gt; 573, 560, 977, 2129, 1159, 1543, 509, 1502, 660, 2150, 448,…
$ geometry   &lt;POINT [m]&gt; POINT (13576.31 32883.65), POINT (13228.59 44206.38),…</code></pre>
</div>
</div>
</section>
<section id="combine-trips-and-hexagon" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="combine-trips-and-hexagon"><span class="header-section-number">3.3</span> Combine Trips and Hexagon</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add origin_hex to odb10</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>odb_hex <span class="ot">&lt;-</span> odb10 <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(busstop_with_hex_info <span class="sc">%&gt;%</span> <span class="fu">select</span>(BUS_STOP_N, hexagon_id), </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ORIGIN_PT_CODE"</span> <span class="ot">=</span> <span class="st">"BUS_STOP_N"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">origin_hex =</span> hexagon_id)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add destination_hex to odb10</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>odb_hex <span class="ot">&lt;-</span> odb_hex <span class="sc">%&gt;%</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(busstop_with_hex_info <span class="sc">%&gt;%</span> <span class="fu">select</span>(BUS_STOP_N, hexagon_id), </span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"DESTINATION_PT_CODE"</span> <span class="ot">=</span> <span class="st">"BUS_STOP_N"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">destination_hex =</span> hexagon_id)</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove additional geometry columns</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>odb_hex <span class="ot">&lt;-</span> odb_hex <span class="sc">%&gt;%</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"geometry."</span>))</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert hex id to factor</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>odb_hex <span class="ot">&lt;-</span> odb_hex <span class="sc">%&gt;%</span></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">origin_hex =</span> <span class="fu">as.factor</span>(origin_hex),</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">destination_hex =</span> <span class="fu">as.factor</span>(destination_hex)</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a><span class="co"># check the output</span></span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(odb_hex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 242,208
Columns: 5
Groups: ORIGIN_PT_CODE [5,029]
$ ORIGIN_PT_CODE      &lt;fct&gt; 01012, 01012, 01012, 01012, 01012, 01012, 01012, 0…
$ DESTINATION_PT_CODE &lt;fct&gt; 01112, 01113, 01121, 01211, 01311, 07371, 60011, 6…
$ TRIPS               &lt;dbl&gt; 290, 118, 77, 118, 165, 14, 30, 16, 35, 26, 2, 8, …
$ origin_hex          &lt;fct&gt; 1474, 1474, 1474, 1474, 1474, 1474, 1474, 1474, 14…
$ destination_hex     &lt;fct&gt; 1496, 1496, 1538, 1538, 1559, 1559, 1539, 1581, 16…</code></pre>
</div>
</div>
</section>
<section id="final-duplicate-checking" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="final-duplicate-checking"><span class="header-section-number">3.4</span> Final Duplicate Checking</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="fu">n_distinct</span>(odb_hex) <span class="sc">==</span> <span class="fu">nrow</span>(odb_hex), <span class="st">"no duplicates detected"</span>, <span class="st">"possible duplicates detected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "no duplicates detected"</code></pre>
</div>
</div>
</section>
<section id="construct-o-d-matrix" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="construct-o-d-matrix"><span class="header-section-number">3.5</span> Construct O-D Matrix</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with missing values</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>clean_odb <span class="ot">&lt;-</span> odb_hex[<span class="fu">complete.cases</span>(odb_hex), ]</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate data based on origin_hex and destination_hex</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>odb_flow <span class="ot">&lt;-</span> clean_odb <span class="sc">%&gt;%</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(origin_hex, destination_hex) <span class="sc">%&gt;%</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">trips =</span> <span class="fu">sum</span>(TRIPS),</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">origin_hex =</span> <span class="fu">unique</span>(origin_hex),</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">destination_hex =</span> <span class="fu">unique</span>(destination_hex)) <span class="sc">%&gt;%</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="co"># check the output</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(odb_flow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 65,510
Columns: 3
$ origin_hex      &lt;fct&gt; 1474, 1474, 1474, 1474, 1474, 1474, 1474, 1474, 1474, …
$ destination_hex &lt;fct&gt; 1496, 1538, 1539, 1559, 1581, 1582, 1601, 1602, 1603, …
$ trips           &lt;dbl&gt; 1091, 766, 230, 311, 32, 63, 153, 77, 29, 127, 218, 15…</code></pre>
</div>
</div>
</section>
<section id="create-distance-variable" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="create-distance-variable"><span class="header-section-number">3.6</span> Create Distance Variable</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set busstop to spatial</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>busstop_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(busstop_with_hex_info, <span class="st">"Spatial"</span>)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the distance</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>tp_dist <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">spDists</span>(busstop_sp, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add column names to the variable</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>hex_id_names <span class="ot">&lt;-</span> busstop_sp<span class="sc">$</span>hexagon_id</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tp_dist) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(hex_id_names)</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tp_dist) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(hex_id_names)</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="co"># melt the table</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(tp_dist) <span class="sc">%&gt;%</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">origin_hex =</span> Var1,</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">destination_hex =</span> Var2,</span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">distance =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origin_hex =</span> <span class="fu">as.factor</span>(origin_hex),</span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">destination_hex =</span> <span class="fu">as.factor</span>(destination_hex))</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a><span class="co"># remove duplicates</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">distinct</span>(dist, origin_hex, destination_hex, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform left join to odb_flow with factor conversion</span></span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>odb_flow <span class="ot">&lt;-</span> odb_flow <span class="sc">%&gt;%</span></span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a>    dist <span class="sc">%&gt;%</span> <span class="fu">select</span>(origin_hex, destination_hex, distance) <span class="sc">%&gt;%</span></span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(origin_hex, destination_hex), as.character)),</span>
<span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"origin_hex"</span>, <span class="st">"destination_hex"</span>)</span>
<span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(origin_hex, destination_hex), as.factor))</span>
<span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a><span class="co"># check the output</span></span>
<span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(odb_flow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 65,510
Columns: 4
$ origin_hex      &lt;fct&gt; 1474, 1474, 1474, 1474, 1474, 1474, 1474, 1474, 1474, …
$ destination_hex &lt;fct&gt; 1496, 1538, 1539, 1559, 1581, 1582, 1601, 1602, 1603, …
$ trips           &lt;dbl&gt; 1091, 766, 230, 311, 32, 63, 153, 77, 29, 127, 218, 15…
$ distance        &lt;dbl&gt; 337.7979, 1089.6612, 1816.6628, 1553.0464, 2308.2822, …</code></pre>
</div>
</div>
</section>
<section id="remove-intra-zonal-flows" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="remove-intra-zonal-flows"><span class="header-section-number">3.7</span> Remove Intra-Zonal Flows</h2>
<p>the following code chunk will remove intra-zonal flows</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>odb_flow <span class="ot">&lt;-</span> odb_flow <span class="sc">%&gt;%</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.character</span>(origin_hex) <span class="sc">!=</span> <span class="fu">as.character</span>(destination_hex))</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check the output</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(odb_flow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 64,885
Columns: 4
$ origin_hex      &lt;fct&gt; 1474, 1474, 1474, 1474, 1474, 1474, 1474, 1474, 1474, …
$ destination_hex &lt;fct&gt; 1496, 1538, 1539, 1559, 1581, 1582, 1601, 1602, 1603, …
$ trips           &lt;dbl&gt; 1091, 766, 230, 311, 32, 63, 153, 77, 29, 127, 218, 15…
$ distance        &lt;dbl&gt; 337.7979, 1089.6612, 1816.6628, 1553.0464, 2308.2822, …</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Why intra-zonal flows is removed?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why intra-zonal flows is removed?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The exclusion of intra-zonal flows from the Spatial Interaction Model calibration process is likely driven by the desire to focus on modeling and understanding interactions between different zones, without interference from flows within the same zone.</p>
<p>Intra-zonal flows, representing movements within a single zone, may not contribute significantly to the overall spatial interaction patterns that the model aims to capture. By removing intra-zonal flows, the analysis can concentrate on the dynamics and factors influencing interactions between distinct zones, providing a clearer and more interpretable representation of spatial relationships.</p>
<p>Including intra-zonal flows in the model might introduce unnecessary complexity or noise, potentially affecting the accuracy and interpretability of the model’s results. Therefore, excluding intra-zonal flows is a methodological choice to streamline the analysis and enhance the model’s ability to capture meaningful inter-zonal interactions.</p>
</div>
</div>
</div>
</section>
</section>
<section id="visualize-the-desire-lines" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Visualize the Desire Lines</h1>
<p>firstly, create the line</p>
<p>There are important arguments in od2line:</p>
<p>flow: A data frame representing the origin-destination data. The first column should be the same as the first column of the data in the zones dataframe.</p>
<p>zones: The origin and destination of the travels should be passed here.</p>
<p>zone_code: Name of the variable in zones containing the ids of the zones.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>flowline <span class="ot">&lt;-</span> <span class="fu">od2line</span>(<span class="at">flow =</span> odb_flow, </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">zones =</span> hexagons_with_bus_stops,</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">zone_code =</span> <span class="st">'hexagon_id'</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(flowline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 64,885
Columns: 5
$ origin_hex      &lt;fct&gt; 1474, 1474, 1474, 1474, 1474, 1474, 1474, 1474, 1474, …
$ destination_hex &lt;fct&gt; 1496, 1538, 1539, 1559, 1581, 1582, 1601, 1602, 1603, …
$ trips           &lt;dbl&gt; 1091, 766, 230, 311, 32, 63, 153, 77, 29, 127, 218, 15…
$ distance        &lt;dbl&gt; 337.7979, 1089.6612, 1816.6628, 1553.0464, 2308.2822, …
$ geometry        &lt;LINESTRING [m]&gt; LINESTRING (29845.12 31028...., LINESTRING …</code></pre>
</div>
</div>
<section id="rd-quantile-trips-175" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="rd-quantile-trips-175"><span class="header-section-number">4.1</span> 3rd Quantile Trips (175)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(flowline<span class="sc">$</span>trips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    1.0     7.0    38.0   375.7   175.0 97602.0 </code></pre>
</div>
</div>
<p>since trips without filter will be too messy, first trial will use the third quantile</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hexagons_with_bus_stops) <span class="sc">+</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> <span class="st">'gray'</span>) <span class="sc">+</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>flowline <span class="sc">%&gt;%</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(trips <span class="sc">&gt;=</span> <span class="dv">175</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">'coral'</span>,</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">lwd =</span> <span class="st">"trips"</span>,</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Weekday Morning Peak Flow for 3rd Quantile Trips'</span>, <span class="at">main.title.position =</span> <span class="st">'center'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>busier in central and east</p>
</section>
<section id="th-quantile-trips-6082" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="th-quantile-trips-6082"><span class="header-section-number">4.2</span> 99th Quantile Trips (6082)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(flowline<span class="sc">$</span>trips, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      0%       1%       2%       3%       4%       5%       6%       7% 
    1.00     1.00     1.00     1.00     1.00     1.00     1.00     1.00 
      8%       9%      10%      11%      12%      13%      14%      15% 
    2.00     2.00     2.00     2.00     2.00     2.00     3.00     3.00 
     16%      17%      18%      19%      20%      21%      22%      23% 
    3.00     4.00     4.00     4.00     5.00     5.00     6.00     6.00 
     24%      25%      26%      27%      28%      29%      30%      31% 
    7.00     7.00     8.00     8.00     9.00    10.00    11.00    12.00 
     32%      33%      34%      35%      36%      37%      38%      39% 
   13.00    13.00    14.00    15.00    16.00    18.00    19.00    20.00 
     40%      41%      42%      43%      44%      45%      46%      47% 
   21.00    22.00    24.00    25.00    27.00    28.00    30.00    32.00 
     48%      49%      50%      51%      52%      53%      54%      55% 
   33.00    35.00    38.00    40.00    42.00    45.00    47.00    50.00 
     56%      57%      58%      59%      60%      61%      62%      63% 
   53.00    57.00    60.00    64.00    67.00    71.00    76.00    81.00 
     64%      65%      66%      67%      68%      69%      70%      71% 
   86.00    91.00    97.00   103.00   110.00   117.00   125.00   134.00 
     72%      73%      74%      75%      76%      77%      78%      79% 
  143.00   153.00   163.00   175.00   188.00   202.00   217.00   233.00 
     80%      81%      82%      83%      84%      85%      86%      87% 
  254.00   276.00   301.00   327.00   357.00   391.00   429.24   475.00 
     88%      89%      90%      91%      92%      93%      94%      95% 
  523.00   586.00   661.00   747.44   854.00   998.00  1170.00  1413.80 
     96%      97%      98%      99%     100% 
 1766.00  2335.44  3384.32  6082.16 97602.00 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hexagons_with_bus_stops) <span class="sc">+</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> <span class="st">'gray'</span>) <span class="sc">+</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>flowline <span class="sc">%&gt;%</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(trips <span class="sc">&gt;=</span> <span class="dv">6082</span>) <span class="sc">%&gt;%</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">'coral'</span>,</span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">lwd =</span> <span class="st">"trips"</span>,</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>))<span class="sc">+</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Weekday Morning Peak Flow for 99th Percentile Trips'</span>, <span class="at">main.title.position =</span> <span class="st">'center'</span>,</span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>north-downtown and north-east becomes more visible</p>
</section>
<section id="rd-quantile-distance-8923" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="rd-quantile-distance-8923"><span class="header-section-number">4.3</span> 3rd Quantile Distance (8923)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(flowline<span class="sc">$</span>distance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
   36.87  2975.46  5478.89  6347.13  8923.04 25292.04 </code></pre>
</div>
</div>
<p>since trips without filter will be too messy, first trial will use the third quantile</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hexagons_with_bus_stops) <span class="sc">+</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> <span class="st">'gray'</span>) <span class="sc">+</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>flowline <span class="sc">%&gt;%</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(distance <span class="sc">&gt;=</span> <span class="dv">8923</span>) <span class="sc">%&gt;%</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">'coral'</span>,</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">lwd =</span> <span class="st">"trips"</span>,</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Weekday Morning Peak Flowline for 3rd Quantile Distance'</span>, <span class="at">main.title.position =</span> <span class="st">'center'</span>,</span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>busier in central and east</p>
</section>
<section id="th-quantile-distance-18587" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="th-quantile-distance-18587"><span class="header-section-number">4.4</span> 99th Quantile Distance (18587)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(flowline<span class="sc">$</span>distance, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         0%          1%          2%          3%          4%          5% 
   36.87007   522.53556   703.08425   842.92091   957.30393  1076.69574 
         6%          7%          8%          9%         10%         11% 
 1191.59355  1294.46529  1395.65614  1489.93693  1590.51016  1692.12325 
        12%         13%         14%         15%         16%         17% 
 1788.92064  1884.42267  1968.51790  2066.41607  2153.43370  2248.29253 
        18%         19%         20%         21%         22%         23% 
 2338.39987  2428.43872  2528.60989  2612.44437  2706.87957  2792.76077 
        24%         25%         26%         27%         28%         29% 
 2875.97264  2975.46354  3062.97268  3156.09125  3248.58762  3341.38852 
        30%         31%         32%         33%         34%         35% 
 3436.60368  3532.15466  3619.70478  3714.09747  3821.74327  3915.36034 
        36%         37%         38%         39%         40%         41% 
 4013.05342  4111.42886  4211.00286  4309.25745  4407.09453  4506.11532 
        42%         43%         44%         45%         46%         47% 
 4606.54736  4724.02732  4829.68679  4923.53519  5029.76657  5148.01533 
        48%         49%         50%         51%         52%         53% 
 5256.28523  5366.38472  5478.89233  5590.89734  5703.79373  5819.80587 
        54%         55%         56%         57%         58%         59% 
 5944.54472  6059.26949  6179.22714  6300.95726  6428.67668  6545.52174 
        60%         61%         62%         63%         64%         65% 
 6669.27414  6806.63320  6922.99694  7069.83774  7213.24856  7348.42508 
        66%         67%         68%         69%         70%         71% 
 7493.32313  7632.98202  7789.55420  7938.62851  8100.13558  8257.52288 
        72%         73%         74%         75%         76%         77% 
 8421.55252  8580.78061  8745.64754  8923.04164  9097.35752  9283.90751 
        78%         79%         80%         81%         82%         83% 
 9487.10764  9677.10337  9869.40942 10077.52431 10281.94764 10486.38616 
        84%         85%         86%         87%         88%         89% 
10700.11506 10930.16294 11188.95602 11451.48411 11717.97156 12036.64141 
        90%         91%         92%         93%         94%         95% 
12378.97126 12746.11568 13121.55663 13560.13147 13987.01526 14526.64946 
        96%         97%         98%         99%        100% 
15194.10259 15983.84859 17018.69635 18587.39427 25292.03624 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hexagons_with_bus_stops) <span class="sc">+</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> <span class="st">'gray'</span>) <span class="sc">+</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>flowline <span class="sc">%&gt;%</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(trips <span class="sc">&gt;=</span> <span class="dv">6082</span>) <span class="sc">%&gt;%</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">'coral'</span>,</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">lwd =</span> <span class="st">"trips"</span>,</span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>))<span class="sc">+</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">'Weekday Morning Peak Flowline for 99th Percentile Distance'</span>, <span class="at">main.title.position =</span> <span class="st">'center'</span>,</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="the2_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>north-downtown and north-east becomes more visible</p>
</section>
<section id="use-gif" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="use-gif"><span class="header-section-number">4.5</span> Use GIF</h2>
</section>
</section>
<section id="assembling-push-pull-factor" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Assembling Push &amp; Pull Factor</h1>
<section id="push" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="push"><span class="header-section-number">5.1</span> Push</h2>
<p>show flow vs variables ## Pull show flow vs variables</p>
</section>
</section>
<section id="spatial-interaction-model" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Spatial Interaction Model</h1>
<section id="correlation-analysis" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="correlation-analysis"><span class="header-section-number">6.1</span> Correlation Analysis</h2>
</section>
<section id="run-the-model" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="run-the-model"><span class="header-section-number">6.2</span> Run the Model</h2>
</section>
<section id="compare-the-result" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="compare-the-result"><span class="header-section-number">6.3</span> Compare The Result</h2>
<p>add R2 on top of RMSE ## Visualize the Result Fitted Value</p>
<p>Log it</p>
</section>
<section id="conclusion" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">6.4</span> Conclusion</h2>
</section>
</section>
<section id="references" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> References</h1>
<p>Cengel. <a href="https://cengel.github.io/R-spatial/intro.html">Introduction to spatial data in R</a></p>
<p>Coşkun, et al.&nbsp;(2020). <a href="https://isprs-archives.copernicus.org/articles/XLIII-B4-2020/449/2020/isprs-archives-XLIII-B4-2020-449-2020.pdf">Performance Matters on Identification of Origin-Destination Matrix on Geospatial Big Data</a></p>
<p>Daniels &amp; Mulley. <a href="https://www.jstor.org/stable/26202654">Explaining walking distance to public transport: The dominance of public transport supply</a></p>
<p>Haynes &amp; Fotheringham (1985). <a href="https://researchrepository.wvu.edu/rri-web-book/16/">Gravity and Spatial Interaction Models</a></p>
<p>Kam Tin Seong. <a href="https://r4gdsa.netlify.app/chap16">16 Calibrating Spatial Interaction Models with R</a></p>
<p>Miller (2021). <a href="https://tmg.utoronto.ca/files/Reports/Traffic-Zone-Guidance_March-2021_Final.pdf">TRAFFIC ANALYSIS ZONE DEFINITION: ISSUES &amp; GUIDANCE</a></p>
<p>R. <a href="https://cran.r-project.org/web/packages/simodels/vignettes/simodels.html.">Spatial interaction models with R</a></p>
<p>Sekste and Kazakov. <a href="https://www.kontur.io/blog/h3-hexagonal-grid/">“H3 hexagonal grid: Why we use it for data analysis and visualization”</a>.</p>
<p>Sid Dhuri (2020). <a href="https://medium.com/swlh/spatial-data-analysis-with-hexagonal-grids-961de90a220e">“Spatial Data Analysis With Hexagonal Grids”</a></p>
<p>Tao Ran (2021). <a href="https://doi.org/10.1007/978-3-030-55462-0_7">Big Spatial Flow Data Analytics. In: Werner, M., Chiang, YY. (eds) Handbook of Big Geospatial Data</a></p>
<p>Land Transport Authority. <a href="https://datamall.lta.gov.sg/content/datamall/en.html">Land Transport Data Mall</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>